"use strict";var Lt=Object.create;var j=Object.defineProperty;var jt=Object.getOwnPropertyDescriptor;var Dt=Object.getOwnPropertyNames;var Ot=Object.getPrototypeOf,Ct=Object.prototype.hasOwnProperty;var u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ht=(e,t)=>{for(var r in t)j(e,r,{get:t[r],enumerable:!0})},Me=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Dt(t))!Ct.call(e,i)&&i!==r&&j(e,i,{get:()=>t[i],enumerable:!(n=jt(t,i))||n.enumerable});return e};var F=(e,t,r)=>(r=e!=null?Lt(Ot(e)):{},Me(t||!e||!e.__esModule?j(r,"default",{value:e,enumerable:!0}):r,e)),qt=e=>Me(j({},"__esModule",{value:!0}),e);var Ne=u((Tn,le)=>{typeof Object.create=="function"?le.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:le.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}});var ke=u((Sn,fe)=>{try{if(he=require("util"),typeof he.inherits!="function")throw"";fe.exports=he.inherits}catch{fe.exports=Ne()}var he});var ze=u((_n,pe)=>{var Mt=ke(),Ae=require("events").EventEmitter;pe.exports=y;pe.exports.default=y;function y(e){if(!(this instanceof y))return new y(e);Ae.call(this),e=e||{},this.concurrency=e.concurrency||1/0,this.timeout=e.timeout||0,this.autostart=e.autostart||!1,this.results=e.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}Mt(y,Ae);var Nt=["pop","shift","indexOf","lastIndexOf"];Nt.forEach(function(e){y.prototype[e]=function(){return Array.prototype[e].apply(this.jobs,arguments)}});y.prototype.slice=function(e,t){return this.jobs=this.jobs.slice(e,t),this};y.prototype.reverse=function(){return this.jobs.reverse(),this};var kt=["push","unshift","splice"];kt.forEach(function(e){y.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this.autostart&&this.start(),t}});Object.defineProperty(y.prototype,"length",{get:function(){return this.pending+this.jobs.length}});y.prototype.start=function(e){if(e&&zt.call(this,e),this.running=!0,this.pending>=this.concurrency)return;if(this.jobs.length===0){this.pending===0&&ge.call(this);return}var t=this,r=this.jobs.shift(),n=!0,i=this.session,o=null,d=!1,l=null,f=r.hasOwnProperty("timeout")?r.timeout:this.timeout;function s(h,I){n&&t.session===i&&(n=!1,t.pending--,o!==null&&(delete t.timers[o],clearTimeout(o)),h?t.emit("error",h,r):d===!1&&(l!==null&&(t.results[l]=Array.prototype.slice.call(arguments,1)),t.emit("success",I,r)),t.session===i&&(t.pending===0&&t.jobs.length===0?ge.call(t):t.running&&t.start()))}f&&(o=setTimeout(function(){d=!0,t.listeners("timeout").length>0?t.emit("timeout",s,r):s()},f),this.timers[o]=o),this.results&&(l=this.results.length,this.results[l]=null),this.pending++,t.emit("start",r);var m=r(s);m&&m.then&&typeof m.then=="function"&&m.then(function(h){return s(null,h)}).catch(function(h){return s(h||!0)}),this.running&&this.jobs.length>0&&this.start()};y.prototype.stop=function(){this.running=!1};y.prototype.end=function(e){At.call(this),this.jobs.length=0,this.pending=0,ge.call(this,e)};function At(){for(var e in this.timers){var t=this.timers[e];delete this.timers[e],clearTimeout(t)}}function zt(e){var t=this;this.on("error",r),this.on("end",n);function r(i){t.end(i)}function n(i){t.removeListener("error",r),t.removeListener("end",n),e(i,this.results)}}function ge(e){this.session++,this.running=!1,this.emit("end",e)}});var g=u(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.findBox=c.readUInt=c.readUInt32LE=c.readUInt32BE=c.readInt32LE=c.readUInt24LE=c.readUInt16LE=c.readUInt16BE=c.readInt16LE=c.toHexString=c.toUTF8String=void 0;var Gt=new TextDecoder,$t=(e,t=0,r=e.length)=>Gt.decode(e.slice(t,r));c.toUTF8String=$t;var Rt=(e,t=0,r=e.length)=>e.slice(t,r).reduce((n,i)=>n+("0"+i.toString(16)).slice(-2),"");c.toHexString=Rt;var Vt=(e,t=0)=>{let r=e[t]+e[t+1]*256;return r|(r&2**15)*131070};c.readInt16LE=Vt;var Yt=(e,t=0)=>e[t]*2**8+e[t+1];c.readUInt16BE=Yt;var Wt=(e,t=0)=>e[t]+e[t+1]*2**8;c.readUInt16LE=Wt;var Jt=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16;c.readUInt24LE=Jt;var Xt=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16+(e[t+3]<<24);c.readInt32LE=Xt;var Kt=(e,t=0)=>e[t]*2**24+e[t+1]*2**16+e[t+2]*2**8+e[t+3];c.readUInt32BE=Kt;var Zt=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16+e[t+3]*2**24;c.readUInt32LE=Zt;var Qt={readUInt16BE:c.readUInt16BE,readUInt16LE:c.readUInt16LE,readUInt32BE:c.readUInt32BE,readUInt32LE:c.readUInt32LE};function er(e,t,r,n){r=r||0;let i=n?"BE":"LE",o="readUInt"+t+i;return Qt[o](e,r)}c.readUInt=er;function tr(e,t){if(e.length-t<4)return;let r=(0,c.readUInt32BE)(e,t);if(!(e.length-t<r))return{name:(0,c.toUTF8String)(e,4+t,8+t),offset:t,size:r}}function rr(e,t,r){for(;r<e.length;){let n=tr(e,r);if(!n)break;if(n.name===t)return n;r+=n.size}}c.findBox=rr});var Ge=u(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.BMP=void 0;var me=g();D.BMP={validate:e=>(0,me.toUTF8String)(e,0,2)==="BM",calculate:e=>({height:Math.abs((0,me.readInt32LE)(e,22)),width:(0,me.readUInt32LE)(e,18)})}});var ve=u(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.ICO=void 0;var O=g(),nr=1,ir=6,or=16;function $e(e,t){let r=e[t];return r===0?256:r}function Re(e,t){let r=ir+t*or;return{height:$e(e,r+1),width:$e(e,r)}}C.ICO={validate(e){let t=(0,O.readUInt16LE)(e,0),r=(0,O.readUInt16LE)(e,4);return t!==0||r===0?!1:(0,O.readUInt16LE)(e,2)===nr},calculate(e){let t=(0,O.readUInt16LE)(e,4),r=Re(e,0);if(t===1)return r;let n=[r];for(let i=1;i<t;i+=1)n.push(Re(e,i));return{height:r.height,images:n,width:r.width}}}});var Ve=u(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.CUR=void 0;var sr=ve(),ye=g(),cr=2;H.CUR={validate(e){let t=(0,ye.readUInt16LE)(e,0),r=(0,ye.readUInt16LE)(e,4);return t!==0||r===0?!1:(0,ye.readUInt16LE)(e,2)===cr},calculate:e=>sr.ICO.calculate(e)}});var Ye=u(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.DDS=void 0;var Ee=g();q.DDS={validate:e=>(0,Ee.readUInt32LE)(e,0)===542327876,calculate:e=>({height:(0,Ee.readUInt32LE)(e,12),width:(0,Ee.readUInt32LE)(e,16)})}});var We=u(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.GIF=void 0;var Ie=g(),ar=/^GIF8[79]a/;M.GIF={validate:e=>ar.test((0,Ie.toUTF8String)(e,0,6)),calculate:e=>({height:(0,Ie.readUInt16LE)(e,8),width:(0,Ie.readUInt16LE)(e,6)})}});var Je=u(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.HEIF=void 0;var x=g(),dr={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"};N.HEIF={validate(e){let t=(0,x.toUTF8String)(e,4,8),r=(0,x.toUTF8String)(e,8,12);return t==="ftyp"&&r in dr},calculate(e){let t=(0,x.findBox)(e,"meta",0),r=t&&(0,x.findBox)(e,"iprp",t.offset+12),n=r&&(0,x.findBox)(e,"ipco",r.offset+8),i=n&&(0,x.findBox)(e,"ispe",n.offset+8);if(i)return{height:(0,x.readUInt32BE)(e,i.offset+16),width:(0,x.readUInt32BE)(e,i.offset+12),type:(0,x.toUTF8String)(e,8,12)};throw new TypeError("Invalid HEIF, no size found")}}});var Ze=u(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.ICNS=void 0;var k=g(),ur=8,lr=4,hr=4,fr={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024};function Xe(e,t){let r=t+hr;return[(0,k.toUTF8String)(e,t,r),(0,k.readUInt32BE)(e,r)]}function Ke(e){let t=fr[e];return{width:t,height:t,type:e}}A.ICNS={validate:e=>(0,k.toUTF8String)(e,0,4)==="icns",calculate(e){let t=e.length,r=(0,k.readUInt32BE)(e,lr),n=ur,i=Xe(e,n),o=Ke(i[0]);if(n+=i[1],n===r)return o;let d={height:o.height,images:[o],width:o.width};for(;n<r&&n<t;)i=Xe(e,n),o=Ke(i[0]),n+=i[1],d.images.push(o);return d}}});var Qe=u(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.J2C=void 0;var xe=g();z.J2C={validate:e=>(0,xe.toHexString)(e,0,4)==="ff4fff51",calculate:e=>({height:(0,xe.readUInt32BE)(e,12),width:(0,xe.readUInt32BE)(e,8)})}});var et=u(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.JP2=void 0;var U=g();G.JP2={validate(e){if((0,U.readUInt32BE)(e,4)!==1783636e3||(0,U.readUInt32BE)(e,0)<1)return!1;let t=(0,U.findBox)(e,"ftyp",0);return t?(0,U.readUInt32BE)(e,t.offset+4)===1718909296:!1},calculate(e){let t=(0,U.findBox)(e,"jp2h",0),r=t&&(0,U.findBox)(e,"ihdr",t.offset+8);if(r)return{height:(0,U.readUInt32BE)(e,r.offset+8),width:(0,U.readUInt32BE)(e,r.offset+12)};throw new TypeError("Unsupported JPEG 2000 format")}}});var rt=u($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.JPG=void 0;var E=g(),gr="45786966",pr=2,we=6,mr=2,vr="4d4d",yr="4949",tt=12,Er=2;function Ir(e){return(0,E.toHexString)(e,2,6)===gr}function xr(e,t){return{height:(0,E.readUInt16BE)(e,t),width:(0,E.readUInt16BE)(e,t+2)}}function wr(e,t){let n=we+8,i=(0,E.readUInt)(e,16,n,t);for(let o=0;o<i;o++){let d=n+Er+o*tt,l=d+tt;if(d>e.length)return;let f=e.slice(d,l);if((0,E.readUInt)(f,16,0,t)===274)return(0,E.readUInt)(f,16,2,t)!==3||(0,E.readUInt)(f,32,4,t)!==1?void 0:(0,E.readUInt)(f,16,8,t)}}function Ur(e,t){let r=e.slice(pr,t),n=(0,E.toHexString)(r,we,we+mr),i=n===vr;if(i||n===yr)return wr(r,i)}function Tr(e,t){if(t>e.length)throw new TypeError("Corrupt JPG, exceeded buffer limits")}$.JPG={validate:e=>(0,E.toHexString)(e,0,2)==="ffd8",calculate(e){e=e.slice(4);let t,r;for(;e.length;){let n=(0,E.readUInt16BE)(e,0);if(e[n]!==255){e=e.slice(1);continue}if(Ir(e)&&(t=Ur(e,n)),Tr(e,n),r=e[n+1],r===192||r===193||r===194){let i=xr(e,n+5);return t?{height:i.height,orientation:t,width:i.width}:i}e=e.slice(n+2)}throw new TypeError("Invalid JPG, no size found")}}});var nt=u(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.KTX=void 0;var Ue=g();R.KTX={validate:e=>{let t=(0,Ue.toUTF8String)(e,1,7);return["KTX 11","KTX 20"].includes(t)},calculate:e=>{let t=e[5]===49?"ktx":"ktx2",r=t==="ktx"?36:20;return{height:(0,Ue.readUInt32LE)(e,r+4),width:(0,Ue.readUInt32LE)(e,r),type:t}}}});var ot=u(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.PNG=void 0;var T=g(),Sr=`PNG\r

`,_r="IHDR",it="CgBI";V.PNG={validate(e){if(Sr===(0,T.toUTF8String)(e,1,8)){let t=(0,T.toUTF8String)(e,12,16);if(t===it&&(t=(0,T.toUTF8String)(e,28,32)),t!==_r)throw new TypeError("Invalid PNG");return!0}return!1},calculate(e){return(0,T.toUTF8String)(e,12,16)===it?{height:(0,T.readUInt32BE)(e,36),width:(0,T.readUInt32BE)(e,32)}:{height:(0,T.readUInt32BE)(e,20),width:(0,T.readUInt32BE)(e,16)}}}});var at=u(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.PNM=void 0;var Te=g(),st={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},ct={default:e=>{let t=[];for(;e.length>0;){let r=e.shift();if(r[0]!=="#"){t=r.split(" ");break}}if(t.length===2)return{height:parseInt(t[1],10),width:parseInt(t[0],10)};throw new TypeError("Invalid PNM")},pam:e=>{let t={};for(;e.length>0;){let r=e.shift();if(r.length>16||r.charCodeAt(0)>128)continue;let[n,i]=r.split(" ");if(n&&i&&(t[n.toLowerCase()]=parseInt(i,10)),t.height&&t.width)break}if(t.height&&t.width)return{height:t.height,width:t.width};throw new TypeError("Invalid PAM")}};Y.PNM={validate:e=>(0,Te.toUTF8String)(e,0,2)in st,calculate(e){let t=(0,Te.toUTF8String)(e,0,2),r=st[t],n=(0,Te.toUTF8String)(e,3).split(/[\r\n]+/);return(ct[r]||ct.default)(n)}}});var dt=u(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.PSD=void 0;var Se=g();W.PSD={validate:e=>(0,Se.toUTF8String)(e,0,4)==="8BPS",calculate:e=>({height:(0,Se.readUInt32BE)(e,14),width:(0,Se.readUInt32BE)(e,18)})}});var ft=u(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.SVG=void 0;var ut=g(),lt=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,J={height:/\sheight=(['"])([^%]+?)\1/,root:lt,viewbox:/\sviewBox=(['"])(.+?)\1/i,width:/\swidth=(['"])([^%]+?)\1/},_e=2.54,ht={in:96,cm:96/_e,em:16,ex:8,m:96/_e*100,mm:96/_e/10,pc:96/72/12,pt:96/72,px:1},br=new RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(ht).join("|")})?$`);function X(e){let t=br.exec(e);if(t)return Math.round(Number(t[1])*(ht[t[2]]||1))}function Pr(e){let t=e.split(" ");return{height:X(t[3]),width:X(t[2])}}function Fr(e){let t=e.match(J.width),r=e.match(J.height),n=e.match(J.viewbox);return{height:r&&X(r[2]),viewbox:n&&Pr(n[2]),width:t&&X(t[2])}}function Br(e){return{height:e.height,width:e.width}}function Lr(e,t){let r=t.width/t.height;return e.width?{height:Math.floor(e.width/r),width:e.width}:e.height?{height:e.height,width:Math.floor(e.height*r)}:{height:t.height,width:t.width}}K.SVG={validate:e=>lt.test((0,ut.toUTF8String)(e,0,1e3)),calculate(e){let t=(0,ut.toUTF8String)(e).match(J.root);if(t){let r=Fr(t[0]);if(r.width&&r.height)return Br(r);if(r.viewbox)return Lr(r,r.viewbox)}throw new TypeError("Invalid SVG")}}});var gt=u(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.TGA=void 0;var Z=g();Q.TGA={validate(e){return(0,Z.readUInt16LE)(e,0)===0&&(0,Z.readUInt16LE)(e,4)===0},calculate(e){return{height:(0,Z.readUInt16LE)(e,14),width:(0,Z.readUInt16LE)(e,12)}}}});var pt=u(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.TIFF=void 0;var ee=require("fs"),S=g();function jr(e,t,r){let n=(0,S.readUInt)(e,32,4,r),i=1024,o=ee.statSync(t).size;n+i>o&&(i=o-n-10);let d=new Uint8Array(i),l=ee.openSync(t,"r");return ee.readSync(l,d,0,i,n),ee.closeSync(l),d.slice(2)}function Dr(e,t){let r=(0,S.readUInt)(e,16,8,t);return((0,S.readUInt)(e,16,10,t)<<16)+r}function Or(e){if(e.length>24)return e.slice(12)}function Cr(e,t){let r={},n=e;for(;n&&n.length;){let i=(0,S.readUInt)(n,16,0,t),o=(0,S.readUInt)(n,16,2,t),d=(0,S.readUInt)(n,32,4,t);if(i===0)break;d===1&&(o===3||o===4)&&(r[i]=Dr(n,t)),n=Or(n)}return r}function Hr(e){let t=(0,S.toUTF8String)(e,0,2);if(t==="II")return"LE";if(t==="MM")return"BE"}var qr=["49492a00","4d4d002a"];te.TIFF={validate:e=>qr.includes((0,S.toHexString)(e,0,4)),calculate(e,t){if(!t)throw new TypeError("Tiff doesn't support buffer");let r=Hr(e)==="BE",n=jr(e,t,r),i=Cr(n,r),o=i[256],d=i[257];if(!o||!d)throw new TypeError("Invalid Tiff. Missing tags");return{height:d,width:o}}}});var mt=u(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.WEBP=void 0;var w=g();function Mr(e){return{height:1+(0,w.readUInt24LE)(e,7),width:1+(0,w.readUInt24LE)(e,4)}}function Nr(e){return{height:1+((e[4]&15)<<10|e[3]<<2|(e[2]&192)>>6),width:1+((e[2]&63)<<8|e[1])}}function kr(e){return{height:(0,w.readInt16LE)(e,8)&16383,width:(0,w.readInt16LE)(e,6)&16383}}re.WEBP={validate(e){let t=(0,w.toUTF8String)(e,0,4)==="RIFF",r=(0,w.toUTF8String)(e,8,12)==="WEBP",n=(0,w.toUTF8String)(e,12,15)==="VP8";return t&&r&&n},calculate(e){let t=(0,w.toUTF8String)(e,12,16);if(e=e.slice(20,30),t==="VP8X"){let n=e[0],i=(n&192)===0,o=(n&1)===0;if(i&&o)return Mr(e);throw new TypeError("Invalid WebP")}if(t==="VP8 "&&e[0]!==47)return kr(e);let r=(0,w.toHexString)(e,3,6);if(t==="VP8L"&&r!=="9d012a")return Nr(e);throw new TypeError("Invalid WebP")}}});var be=u(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.typeHandlers=void 0;var Ar=Ge(),zr=Ve(),Gr=Ye(),$r=We(),Rr=Je(),Vr=Ze(),Yr=ve(),Wr=Qe(),Jr=et(),Xr=rt(),Kr=nt(),Zr=ot(),Qr=at(),en=dt(),tn=ft(),rn=gt(),nn=pt(),on=mt();ne.typeHandlers={bmp:Ar.BMP,cur:zr.CUR,dds:Gr.DDS,gif:$r.GIF,heif:Rr.HEIF,icns:Vr.ICNS,ico:Yr.ICO,j2c:Wr.J2C,jp2:Jr.JP2,jpg:Xr.JPG,ktx:Kr.KTX,png:Zr.PNG,pnm:Qr.PNM,psd:en.PSD,svg:tn.SVG,tga:rn.TGA,tiff:nn.TIFF,webp:on.WEBP}});var yt=u(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.detector=void 0;var Pe=be(),sn=Object.keys(Pe.typeHandlers),vt={56:"psd",66:"bmp",68:"dds",71:"gif",73:"tiff",77:"tiff",82:"webp",105:"icns",137:"png",255:"jpg"};function cn(e){let t=e[0];if(t in vt){let n=vt[t];if(n&&Pe.typeHandlers[n].validate(e))return n}let r=n=>Pe.typeHandlers[n].validate(e);return sn.find(r)}ie.detector=cn});var wt=u((v,xt)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.types=v.setConcurrency=v.disableTypes=v.disableFS=v.imageSize=void 0;var B=require("fs"),an=require("path"),dn=ze(),Be=be(),un=yt(),Et=512*1024,It=new dn.default({concurrency:100,autostart:!0}),oe={disabledFS:!1,disabledTypes:[]};function Fe(e,t){let r=(0,un.detector)(e);if(typeof r<"u"){if(oe.disabledTypes.indexOf(r)>-1)throw new TypeError("disabled file type: "+r);if(r in Be.typeHandlers){let n=Be.typeHandlers[r].calculate(e,t);if(n!==void 0)return n.type=n.type??r,n}}throw new TypeError("unsupported file type: "+r+" (file: "+t+")")}async function ln(e){let t=await B.promises.open(e,"r");try{let{size:r}=await t.stat();if(r<=0)throw new Error("Empty file");let n=Math.min(r,Et),i=new Uint8Array(n);return await t.read(i,0,n,0),i}finally{await t.close()}}function hn(e){let t=B.openSync(e,"r");try{let{size:r}=B.fstatSync(t);if(r<=0)throw new Error("Empty file");let n=Math.min(r,Et),i=new Uint8Array(n);return B.readSync(t,i,0,n,0),i}finally{B.closeSync(t)}}xt.exports=v=Le;v.default=Le;function Le(e,t){if(e instanceof Uint8Array)return Fe(e);if(typeof e!="string"||oe.disabledFS)throw new TypeError("invalid invocation. input should be a Uint8Array");let r=an.resolve(e);if(typeof t=="function")It.push(()=>ln(r).then(n=>process.nextTick(t,null,Fe(n,r))).catch(t));else{let n=hn(r);return Fe(n,r)}}v.imageSize=Le;var fn=e=>{oe.disabledFS=e};v.disableFS=fn;var gn=e=>{oe.disabledTypes=e};v.disableTypes=gn;var pn=e=>{It.concurrency=e};v.setConcurrency=pn;v.types=Object.keys(Be.typeHandlers)});var wn={};Ht(wn,{activate:()=>In,deactivate:()=>xn,defaultAdjustTopPosition:()=>Pt,defaultIconPath:()=>bt,defaultIconSize:()=>qe,tmpFileName:()=>He});module.exports=qt(wn);var a=F(require("vscode")),b=F(require("fs")),de=F(require("path")),Ce=F(require("os")),_t=F(wt());var p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function Ut(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}var Tt=require("crypto"),ce=new Uint8Array(256),se=ce.length;function je(){return se>ce.length-16&&((0,Tt.randomFillSync)(ce),se=0),ce.slice(se,se+=16)}var St=require("crypto"),De={randomUUID:St.randomUUID};function mn(e,t,r){if(De.randomUUID&&!t&&!e)return De.randomUUID();e=e||{};let n=e.random||(e.rng||je)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=n[i];return t}return Ut(n)}var ae=mn;var He="rustPanicHighlighter_icon_tmp",bt="resources/panic-icon.gif",qe=64,Pt=0,ue=[],_;function vn(e){let t="";return Object.keys(e).map(n=>{if(t=e[n],typeof t=="string"||typeof t=="number")return`${n}: ${t};`}).join(" ")}function yn(){let e=a.workspace.getConfiguration("editor"),t=e.get("fontSize")||14,r=e.get("lineHeight")||0,n;return r===0?n=t:r>0&&r<8?n=t*r:n=r,n}var En=(e,t,r)=>{let n=de.default.extname(e).toLowerCase();if([".gif",".png",".jpg",".jpeg",".svg"].includes(n)){if(n===".svg")try{let d=b.default.readFileSync(e,"utf8").replace(/<svg([^>]*)>/,(m,h)=>{let I=/width\s*=\s*["'].*?["']/.test(h),P=/height\s*=\s*["'].*?["']/.test(h);return`<svg${h+(I?"":` width="${t}"`)+(P?"":` height="${r}"`)}>`}),l=Ce.default.tmpdir(),f=ae(),s=de.default.join(l,`${He}_${f}.svg`);if(b.default.writeFileSync(s,d,"utf8"),ue.push(s),!b.default.existsSync(s))throw new Error(`Failed to create temporary file at ${s}`);return s}catch(o){throw console.error("Error processing the SVG file:",o),new Error(`Unable to process the SVG file: ${e}`)}try{let d=b.default.readFileSync(e).toString("base64"),l="";switch(n){case".gif":l="image/gif";break;case".png":l="image/png";break;case".jpg":case".jpeg":l="image/jpeg";break;default:throw new Error(`Unsupported image format: ${n}`)}let f=`
            <svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${r}">
                <image href="data:${l};base64,${d}" width="${t}" height="${r}"/>
            </svg>
        `,s=Ce.default.tmpdir(),m=ae(),h=de.default.join(s,`${He}_${m}.svg`);if(b.default.writeFileSync(h,f,"utf8"),ue.push(h),!b.default.existsSync(h))throw new Error(`Failed to create temporary file at ${h}`);return h}catch(o){throw console.error("An error occurred while processing the icon:",o),new Error(`An error occurred while processing the icon: ${e}`)}}throw new Error(`Unsupported image format: ${n}`)};function In(e){let t=a.languages.createDiagnosticCollection("rust-panic-highlighter");e.subscriptions.push(t);function r(){if(!(a.workspace.getConfiguration().get("rustPanicHighlighter.icon.enabled")??!0))return a.window.createTextEditorDecorationType({});let i=a.workspace.getConfiguration().get("rustPanicHighlighter.icon.path")||"default";i==="default"&&(i=e.asAbsolutePath(bt));let o=a.workspace.getConfiguration().get("rustPanicHighlighter.icon.size")||qe,d=a.workspace.getConfiguration().get("rustPanicHighlighter.icon.adjustTopPosition")||Pt;if(o!==void 0&&o<=0)throw new Error("icon.size must be a positive number.");let l=`${o}px`,f=`${o}px`,s=En(i,l,f),m=(0,_t.default)(s),h=a.Uri.file(s),I=yn(),P=m.height??qe,L=P<=I?(P-I/4)/2:-((P-I/4)/2);L=L+d;let Ft={position:"absolute",top:`${L}px`,"z-index":1,"pointer-events":"none"},Bt=vn(Ft);return a.window.createTextEditorDecorationType({after:{contentIconPath:h,textDecoration:`none; ${Bt}`,margin:"0 1rem"}})}_=r(),e.subscriptions.push(_),a.workspace.onDidOpenTextDocument(n=>{n.languageId==="rust"&&Oe(n,t,_)}),a.workspace.onDidChangeTextDocument(n=>{n.document.languageId==="rust"&&Oe(n.document,t,_)}),a.workspace.onDidCloseTextDocument(n=>{n.languageId==="rust"&&t.delete(n.uri)}),a.workspace.onDidChangeConfiguration(n=>{(n.affectsConfiguration("rustPanicHighlighter.icon.enabled")||n.affectsConfiguration("rustPanicHighlighter.icon.path")||n.affectsConfiguration("rustPanicHighlighter.icon.size")||n.affectsConfiguration("rustPanicHighlighter.icon.adjustTopPosition"))&&(_.dispose(),ue.forEach(i=>{b.default.promises.unlink(i)}),ue=[],_=r(),e.subscriptions.push(_),a.workspace.textDocuments.forEach(i=>{i.languageId==="rust"&&Oe(i,t,_)}))})}function Oe(e,t,r){let n=[],i=a.window.activeTextEditor,o=[],d=a.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.severity"),l;switch(d){case"Error":l=a.DiagnosticSeverity.Error;break;case"Information":l=a.DiagnosticSeverity.Information;break;case"Hint":l=a.DiagnosticSeverity.Hint;break;case"Warning":default:l=a.DiagnosticSeverity.Warning;break}for(let f=0;f<e.lineCount;f++){let s=e.lineAt(f);if(!s.text.trimStart().startsWith("//")&&(s.text.includes("panic!(")||s.text.includes("unwrap(")||s.text.includes("expect("))){let m="";s.text.includes("panic!(")?m="This line contains a 'panic!' which can cause a runtime panic.":s.text.includes("unwrap(")?m="This line contains an 'unwrap()', which will panic if the result is None or Err.":s.text.includes("expect(")&&(m="This line contains an 'expect()', which will panic if the result is None or Err.");let h=0;s.text.includes("panic!(")?h=s.text.indexOf("panic!("):s.text.includes("unwrap(")?h=s.text.indexOf("unwrap("):s.text.includes("expect(")&&(h=s.text.indexOf("expect("));let I=new a.Range(f,h,f,s.text.length);o.push(I);let P=new a.Diagnostic(I,m,l);n.push(P)}}i&&(o.length>0?i.setDecorations(r,o):i.setDecorations(r,[])),n.length===0?t.delete(e.uri):t.set(e.uri,n)}function xn(){}0&&(module.exports={activate,deactivate,defaultAdjustTopPosition,defaultIconPath,defaultIconSize,tmpFileName});
