"use strict";var Be=Object.create;var z=Object.defineProperty;var ze=Object.getOwnPropertyDescriptor;var je=Object.getOwnPropertyNames;var Ue=Object.getPrototypeOf,Ge=Object.prototype.hasOwnProperty;var $e=(e,t)=>{for(var i in t)z(e,i,{get:t[i],enumerable:!0})},fe=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of je(t))!Ge.call(e,r)&&r!==i&&z(e,r,{get:()=>t[r],enumerable:!(n=ze(t,r))||n.enumerable});return e};var S=(e,t,i)=>(i=e!=null?Be(Ue(e)):{},fe(t||!e||!e.__esModule?z(i,"default",{value:e,enumerable:!0}):i,e)),Me=e=>fe(z({},"__esModule",{value:!0}),e);var xi={};$e(xi,{activate:()=>wi,deactivate:()=>Ti});module.exports=Me(xi);var g=S(require("vscode")),de=S(require("fs"));var x=S(require("vscode")),R=S(require("fs")),W=S(require("path"));var xe=S(require("vscode")),P=S(require("fs")),H=S(require("path")),ee=S(require("os"));var p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function ue(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}var ge=require("crypto"),U=new Uint8Array(256),j=U.length;function Z(){return j>U.length-16&&((0,ge.randomFillSync)(U),j=0),U.slice(j,j+=16)}var pe=require("crypto"),J={randomUUID:pe.randomUUID};function Ye(e,t,i){if(J.randomUUID&&!t&&!e)return J.randomUUID();e=e||{};let n=e.random??e.rng?.()??Z();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){if(i=i||0,i<0||i+16>t.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let r=0;r<16;++r)t[i+r]=n[r];return t}return ue(n)}var q=Ye;var me="rustPanicHighlighter_icon_tmp",L="resources/panic-icon.gif";var ve=[".gif",".png",".jpg",".jpeg",".svg"],K="RustPanicHighlighter",Q=(l=>(l.unwrap="unwrap(",l.unwrap_unchecked="unwrap_unchecked(",l.unwrap_err="unwrap_err(",l.unwrap_err_unchecked="unwrap_err_unchecked(",l.expect='expect("',l.panic="panic!(",l.todo="todo!(",l.unimplemented="unimplemented!(",l.assert="assert!(",l.assert_eq="assert_eq!(",l.assert_ne="assert_ne!(",l))(Q||{}),we={"unwrap(":"This line contains an 'unwrap()', which will panic if the result is None or Err.","unwrap_unchecked(":"This line contains an 'unwrap_unchecked()', which can cause undefined behavior if the result is None or Err.","unwrap_err(":"This line contains an 'unwrap_err()', which will panic if the result is Ok.","unwrap_err_unchecked(":"This line contains an 'unwrap_err_unchecked()', which can cause undefined behavior if the result is Ok.",'expect("':"This line contains an 'expect()', which will panic if the result is None or Err.","panic!(":"This line contains a 'panic!' which can cause a runtime panic.","todo!(":"This line contains a 'todo!' macro, which is a placeholder and will panic if executed.","unimplemented!(":"This line contains an 'unimplemented!' macro, which will panic if executed.","assert!(":"This line contains an 'assert!()', which will panic if the condition is false.","assert_eq!(":"This line contains an 'assert_eq!()', which will panic if the two values are not equal.","assert_ne!(":"This line contains an 'assert_ne!()', which will panic if the two values are equal."};function A(e){let t="";return Object.keys(e).map(n=>{if(t=String(e[n]),typeof t=="string"||typeof t=="number")return`${n}: ${t};`}).join(" ")}function F(){let e=xe.workspace.getConfiguration("editor"),t=e.get("fontSize")||14,i=e.get("lineHeight")||0,n;return i===0?n=t:i>0&&i<8?n=t*i:n=i,n}function Te(e){let t=ee.default.tmpdir(),i=H.default.join(t,K),n=q(),r=H.default.join(i,`${me}_${n}.svg`);return P.default.writeFileSync(r,e,"utf8"),r}function te(){let e=ee.default.tmpdir(),t=H.default.join(e,K);P.default.existsSync(t)?P.default.readdirSync(t).forEach(n=>{let r=H.default.join(t,n);P.default.lstatSync(r).isFile()&&P.default.unlinkSync(r)}):P.default.mkdirSync(t)}function ie(e,t,i){let n=H.default.extname(e).toLowerCase();if(!ve.includes(n))throw new Error(`Unsupported image format: ${n}`);try{if(n===".svg"){let c=P.default.readFileSync(e,"utf8").replace(/<svg([^>]*)>/,(f,l)=>`<svg${l+(/<width\s*=\s*["'].*?["']/.test(l)?"":` width="${t}"`)+(/<height\s*=\s*["'].*?["']/.test(l)?"":` height="${i}"`)}>`);return Te(c)}let o=P.default.readFileSync(e).toString("base64"),s;switch(n){case".gif":s="image/gif";break;case".png":s="image/png";break;case".jpg":case".jpeg":s="image/jpeg";break;default:throw new Error(`Unsupported image format: ${n}`)}let a=`
            <svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${i}">
                <image href="data:${s};base64,${o}" width="${t}" height="${i}"/>
            </svg>
        `;return Te(a)}catch(r){throw console.error("An error occurred while processing the icon:",r),new Error(`An error occurred while processing the icon: ${e}`)}}function ne(e,t){return t==="default"?e.asAbsolutePath(L):t}var Ve=new TextDecoder,h=(e,t=0,i=e.length)=>Ve.decode(e.slice(t,i)),O=(e,t=0,i=e.length)=>e.slice(t,i).reduce((n,r)=>n+`0${r.toString(16)}`.slice(-2),""),N=(e,t)=>new DataView(e.buffer,e.byteOffset+t),be=(e,t=0)=>N(e,t).getInt16(0,!0),$=(e,t=0)=>N(e,t).getUint16(0,!1),w=(e,t=0)=>N(e,t).getUint16(0,!0),ye=(e,t=0)=>{let i=N(e,t);return i.getUint16(0,!0)+(i.getUint8(2)<<16)},We=(e,t=0)=>N(e,t).getInt32(0,!0),u=(e,t=0)=>N(e,t).getUint32(0,!1),_=(e,t=0)=>N(e,t).getUint32(0,!0),se=(e,t,i)=>N(e,t).getBigUint64(0,!i),Xe={readUInt16BE:$,readUInt16LE:w,readUInt32BE:u,readUInt32LE:_};function v(e,t,i=0,n=!1){let o=`readUInt${t}${n?"BE":"LE"}`;return Xe[o](e,i)}function Ze(e,t){if(e.length-t<4)return;let i=u(e,t);if(!(e.length-t<i))return{name:h(e,4+t,8+t),offset:t,size:i}}function I(e,t,i){for(;i<e.length;){let n=Ze(e,i);if(!n)break;if(n.name===t)return n;i+=n.size>0?n.size:8}}var Je={validate:e=>h(e,0,2)==="BM",calculate:e=>({height:Math.abs(We(e,22)),width:_(e,18)})},qe=1,Ke=6,Qe=16;function Ee(e,t){let i=e[t];return i===0?256:i}function Ie(e,t){let i=Ke+t*Qe;return{height:Ee(e,i+1),width:Ee(e,i)}}var Ne={validate(e){let t=w(e,0),i=w(e,4);return t!==0||i===0?!1:w(e,2)===qe},calculate(e){let t=w(e,4),i=Ie(e,0);if(t===1)return i;let n=[];for(let r=0;r<t;r+=1)n.push(Ie(e,r));return{width:i.width,height:i.height,images:n}}},et=2,tt={validate(e){let t=w(e,0),i=w(e,4);return t!==0||i===0?!1:w(e,2)===et},calculate:e=>Ne.calculate(e)},it={validate:e=>_(e,0)===542327876,calculate:e=>({height:_(e,12),width:_(e,16)})},nt=/^GIF8[79]a/,rt={validate:e=>nt.test(h(e,0,6)),calculate:e=>({height:w(e,8),width:w(e,6)})},ot={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"},st={validate(e){if(h(e,4,8)!=="ftyp")return!1;let i=I(e,"ftyp",0);return i?h(e,i.offset+8,i.offset+12)in ot:!1},calculate(e){let t=I(e,"meta",0),i=t&&I(e,"iprp",t.offset+12),n=i&&I(e,"ipco",i.offset+8);if(!n)throw new TypeError("Invalid HEIF, no ipco box found");let r=h(e,8,12),o=[],s=n.offset+8;for(;s<n.offset+n.size;){let a=I(e,"ispe",s);if(!a)break;let d=u(e,a.offset+12),c=u(e,a.offset+16),f=I(e,"clap",s),l=d,m=c;if(f&&f.offset<n.offset+n.size){let b=u(e,f.offset+12);l=d-b}o.push({height:m,width:l}),s=a.offset+a.size}if(o.length===0)throw new TypeError("Invalid HEIF, no sizes found");return{width:o[0].width,height:o[0].height,type:r,...o.length>1?{images:o}:{}}}},at=8,ct=4,lt=4,ht={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024};function dt(e,t){let i=t+lt;return[h(e,t,i),u(e,i)]}function ft(e){let t=ht[e];return{width:t,height:t,type:e}}var ut={validate:e=>h(e,0,4)==="icns",calculate(e){let t=e.length,i=u(e,ct),n=at,r=[];for(;n<i&&n<t;){let o=dt(e,n),s=ft(o[0]);r.push(s),n+=o[1]}if(r.length===0)throw new TypeError("Invalid ICNS, no sizes found");return{width:r[0].width,height:r[0].height,...r.length>1?{images:r}:{}}}},gt={validate:e=>u(e,0)===4283432785,calculate:e=>({height:u(e,12),width:u(e,8)})},pt={validate(e){if(h(e,4,8)!=="jP  ")return!1;let i=I(e,"ftyp",0);return i?h(e,i.offset+8,i.offset+12)==="jp2 ":!1},calculate(e){let t=I(e,"jp2h",0),i=t&&I(e,"ihdr",t.offset+8);if(i)return{height:u(e,i.offset+8),width:u(e,i.offset+12)};throw new TypeError("Unsupported JPEG 2000 format")}},mt="45786966",vt=2,oe=6,wt=2,Tt="4d4d",xt="4949",Se=12,bt=2;function yt(e){return O(e,2,6)===mt}function Et(e,t){return{height:$(e,t),width:$(e,t+2)}}function It(e,t){let n=oe+8,r=v(e,16,n,t);for(let o=0;o<r;o++){let s=n+bt+o*Se,a=s+Se;if(s>e.length)return;let d=e.slice(s,a);if(v(d,16,0,t)===274)return v(d,16,2,t)!==3||v(d,32,4,t)!==1?void 0:v(d,16,8,t)}}function St(e,t){let i=e.slice(vt,t),n=O(i,oe,oe+wt),r=n===Tt;if(r||n===xt)return It(i,r)}function Pt(e,t){if(t>e.length)throw new TypeError("Corrupt JPG, exceeded buffer limits")}var Dt={validate:e=>O(e,0,2)==="ffd8",calculate(e){let t=e.slice(4),i,n;for(;t.length;){let r=$(t,0);if(Pt(t,r),t[r]!==255){t=t.slice(1);continue}if(yt(t)&&(i=St(t,r)),n=t[r+1],n===192||n===193||n===194){let o=Et(t,r+5);return i?{height:o.height,orientation:i,width:o.width}:o}t=t.slice(r+2)}throw new TypeError("Invalid JPG, no size found")}},Ct=class{constructor(e,t){this.input=e,this.endianness=t,this.byteOffset=2,this.bitOffset=0}getBits(e=1){let t=0,i=0;for(;i<e;){if(this.byteOffset>=this.input.length)throw new Error("Reached end of input");let n=this.input[this.byteOffset],r=8-this.bitOffset,o=Math.min(e-i,r);if(this.endianness==="little-endian"){let s=(1<<o)-1,a=n>>this.bitOffset&s;t|=a<<i}else{let s=(1<<o)-1<<8-this.bitOffset-o,a=(n&s)>>8-this.bitOffset-o;t=t<<o|a}i+=o,this.bitOffset+=o,this.bitOffset===8&&(this.byteOffset++,this.bitOffset=0)}return t}};function _e(e,t){if(t)return 8*(1+e.getBits(5));let i=e.getBits(2),n=[9,13,18,30][i];return 1+e.getBits(n)}function Nt(e,t,i,n){if(t&&i===0)return 8*(1+e.getBits(5));if(i===0)return _e(e,!1);let r=[1,1.2,4/3,1.5,16/9,5/4,2];return Math.floor(n*r[i-1])}var ke={validate:e=>O(e,0,2)==="ff0a",calculate(e){let t=new Ct(e,"little-endian"),i=t.getBits(1)===1,n=_e(t,i),r=t.getBits(3);return{width:Nt(t,i,r,n),height:n}}};function _t(e){let t=I(e,"jxlc",0);if(t)return e.slice(t.offset+8,t.offset+t.size);let i=kt(e);if(i.length>0)return Ht(i)}function kt(e){let t=[],i=0;for(;i<e.length;){let n=I(e,"jxlp",i);if(!n)break;t.push(e.slice(n.offset+12,n.offset+n.size)),i=n.offset+n.size}return t}function Ht(e){let t=e.reduce((r,o)=>r+o.length,0),i=new Uint8Array(t),n=0;for(let r of e)i.set(r,n),n+=r.length;return i}var Ot={validate:e=>{if(h(e,4,8)!=="JXL ")return!1;let i=I(e,"ftyp",0);return i?h(e,i.offset+8,i.offset+12)==="jxl ":!1},calculate(e){let t=_t(e);if(t)return ke.calculate(t);throw new Error("No codestream found in JXL container")}},Lt={validate:e=>{let t=h(e,1,7);return["KTX 11","KTX 20"].includes(t)},calculate:e=>{let t=e[5]===49?"ktx":"ktx2",i=t==="ktx"?36:20;return{height:_(e,i+4),width:_(e,i),type:t}}},At=`PNG\r

`,Ft="IHDR",Pe="CgBI",Rt={validate(e){if(At===h(e,1,8)){let t=h(e,12,16);if(t===Pe&&(t=h(e,28,32)),t!==Ft)throw new TypeError("Invalid PNG");return!0}return!1},calculate(e){return h(e,12,16)===Pe?{height:u(e,36),width:u(e,32)}:{height:u(e,20),width:u(e,16)}}},De={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},Ce={default:e=>{let t=[];for(;e.length>0;){let i=e.shift();if(i[0]!=="#"){t=i.split(" ");break}}if(t.length===2)return{height:Number.parseInt(t[1],10),width:Number.parseInt(t[0],10)};throw new TypeError("Invalid PNM")},pam:e=>{let t={};for(;e.length>0;){let i=e.shift();if(i.length>16||i.charCodeAt(0)>128)continue;let[n,r]=i.split(" ");if(n&&r&&(t[n.toLowerCase()]=Number.parseInt(r,10)),t.height&&t.width)break}if(t.height&&t.width)return{height:t.height,width:t.width};throw new TypeError("Invalid PAM")}},Bt={validate:e=>h(e,0,2)in De,calculate(e){let t=h(e,0,2),i=De[t],n=h(e,3).split(/[\r\n]+/);return(Ce[i]||Ce.default)(n)}},zt={validate:e=>h(e,0,4)==="8BPS",calculate:e=>({height:u(e,14),width:u(e,18)})},He=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,G={height:/\sheight=(['"])([^%]+?)\1/,root:He,viewbox:/\sviewBox=(['"])(.+?)\1/i,width:/\swidth=(['"])([^%]+?)\1/},re=2.54,Oe={in:96,cm:96/re,em:16,ex:8,m:96/re*100,mm:96/re/10,pc:96/72/12,pt:96/72,px:1},jt=new RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(Oe).join("|")})?$`);function M(e){let t=jt.exec(e);if(t)return Math.round(Number(t[1])*(Oe[t[2]]||1))}function Ut(e){let t=e.split(" ");return{height:M(t[3]),width:M(t[2])}}function Gt(e){let t=e.match(G.width),i=e.match(G.height),n=e.match(G.viewbox);return{height:i&&M(i[2]),viewbox:n&&Ut(n[2]),width:t&&M(t[2])}}function $t(e){return{height:e.height,width:e.width}}function Mt(e,t){let i=t.width/t.height;return e.width?{height:Math.floor(e.width/i),width:e.width}:e.height?{height:e.height,width:Math.floor(e.height*i)}:{height:t.height,width:t.width}}var Yt={validate:e=>He.test(h(e,0,1e3)),calculate(e){let t=h(e).match(G.root);if(t){let i=Gt(t[0]);if(i.width&&i.height)return $t(i);if(i.viewbox)return Mt(i,i.viewbox)}throw new TypeError("Invalid SVG")}},Vt={validate(e){return w(e,0)===0&&w(e,4)===0},calculate(e){return{height:w(e,14),width:w(e,12)}}},T={TAG:{WIDTH:256,HEIGHT:257,COMPRESSION:259},TYPE:{SHORT:3,LONG:4,LONG8:16},ENTRY_SIZE:{STANDARD:12,BIG:20},COUNT_SIZE:{STANDARD:2,BIG:8}};function Wt(e,{isBigEndian:t,isBigTiff:i}){let n=i?Number(se(e,8,t)):v(e,32,4,t),r=i?T.COUNT_SIZE.BIG:T.COUNT_SIZE.STANDARD;return e.slice(n+r)}function Xt(e,t,i,n){switch(t){case T.TYPE.SHORT:return v(e,16,i,n);case T.TYPE.LONG:return v(e,32,i,n);case T.TYPE.LONG8:{let r=Number(se(e,i,n));if(r>Number.MAX_SAFE_INTEGER)throw new TypeError("Value too large");return r}default:return 0}}function Zt(e,t){let i=t?T.ENTRY_SIZE.BIG:T.ENTRY_SIZE.STANDARD;if(e.length>i)return e.slice(i)}function Jt(e,{isBigEndian:t,isBigTiff:i}){let n={},r=e;for(;r?.length;){let o=v(r,16,0,t),s=v(r,16,2,t),a=i?Number(se(r,4,t)):v(r,32,4,t);if(o===0)break;if(a===1&&(s===T.TYPE.SHORT||s===T.TYPE.LONG||i&&s===T.TYPE.LONG8)){let d=i?12:8;n[o]=Xt(r,s,d,t)}r=Zt(r,i)}return n}function qt(e){let t=h(e,0,2),i=v(e,16,2,t==="MM");return{isBigEndian:t==="MM",isBigTiff:i===43}}function Kt(e,t){let i=v(e,16,4,t),n=v(e,16,6,t);if(i!==8||n!==0)throw new TypeError("Invalid BigTIFF header")}var Qt=new Set(["49492a00","4d4d002a","49492b00","4d4d002b"]),ei={validate:e=>{let t=O(e,0,4);return Qt.has(t)},calculate(e){let t=qt(e);t.isBigTiff&&Kt(e,t.isBigEndian);let i=Wt(e,t),n=Jt(i,t),r={height:n[T.TAG.HEIGHT],width:n[T.TAG.WIDTH],type:t.isBigTiff?"bigtiff":"tiff"};if(n[T.TAG.COMPRESSION]&&(r.compression=n[T.TAG.COMPRESSION]),!r.width||!r.height)throw new TypeError("Invalid Tiff. Missing tags");return r}};function ti(e){return{height:1+ye(e,7),width:1+ye(e,4)}}function ii(e){return{height:1+((e[4]&15)<<10|e[3]<<2|(e[2]&192)>>6),width:1+((e[2]&63)<<8|e[1])}}function ni(e){return{height:be(e,8)&16383,width:be(e,6)&16383}}var ri={validate(e){let t=h(e,0,4)==="RIFF",i=h(e,8,12)==="WEBP",n=h(e,12,15)==="VP8";return t&&i&&n},calculate(e){let t=h(e,12,16),i=e.slice(20,30);if(t==="VP8X"){let r=i[0],o=(r&192)===0,s=(r&1)===0;if(o&&s)return ti(i);throw new TypeError("Invalid WebP")}if(t==="VP8 "&&i[0]!==47)return ni(i);let n=O(i,3,6);if(t==="VP8L"&&n!=="9d012a")return ii(i);throw new TypeError("Invalid WebP")}},Y=new Map([["bmp",Je],["cur",tt],["dds",it],["gif",rt],["heif",st],["icns",ut],["ico",Ne],["j2c",gt],["jp2",pt],["jpg",Dt],["jxl",Ot],["jxl-stream",ke],["ktx",Lt],["png",Rt],["pnm",Bt],["psd",zt],["svg",Yt],["tga",Vt],["tiff",ei],["webp",ri]]),oi=Array.from(Y.keys()),si=new Map([[0,"heif"],[56,"psd"],[66,"bmp"],[68,"dds"],[71,"gif"],[73,"tiff"],[77,"tiff"],[82,"webp"],[105,"icns"],[137,"png"],[255,"jpg"]]);function ai(e){let t=e[0],i=si.get(t);return i&&Y.get(i).validate(e)?i:oi.find(n=>Y.get(n).validate(e))}var ci={disabledTypes:[]};function ae(e){let t=ai(e);if(typeof t<"u"){if(ci.disabledTypes.indexOf(t)>-1)throw new TypeError(`disabled file type: ${t}`);let i=Y.get(t).calculate(e);if(i!==void 0){if(i.type=i.type??t,i.images&&i.images.length>1){let n=i.images.reduce((r,o)=>o.width*o.height>r.width*r.height?o:r,i.images[0]);i.width=n.width,i.height=n.height}return i}}throw new TypeError(`unsupported file type: ${t}`)}function ce(e,t){if(!(x.workspace.getConfiguration().get("rustPanicHighlighter.icon.enabled")??!0))return x.window.createTextEditorDecorationType({});t==="default"&&(t=e.asAbsolutePath(L));let n=x.workspace.getConfiguration().get("rustPanicHighlighter.icon.size")||64,r=x.workspace.getConfiguration().get("rustPanicHighlighter.icon.adjustTopPosition")||0;if(n!==void 0&&n<=0)throw new Error("icon.size must be a positive number.");let o=`${n}px`,s=`${n}px`,a=ie(t,o,s),d=R.readFileSync(a),c=ae(d),f=x.Uri.file(a),l=F(),m=c.height??64,b=m<=l?(m-l/4)/2:-((m-l/4)/2);b=b+r;let D={position:"absolute",top:`${b}px`,"z-index":1,"pointer-events":"none"},y=A(D);return x.window.createTextEditorDecorationType({after:{contentIconPath:f,textDecoration:`none; ${y}`,margin:"0 1rem"}})}function le(e,t){if(!(x.workspace.getConfiguration().get("rustPanicHighlighter.icon.enabled")??!0))return[];t==="default"&&(t=e.asAbsolutePath(L));let n=x.workspace.getConfiguration().get("rustPanicHighlighter.icon.size")||64,r=x.workspace.getConfiguration().get("rustPanicHighlighter.icon.adjustTopPosition")||0;if(n<=0)throw new Error("icon.size must be a positive number.");let o=`${n}px`,s=`${n}px`,a=W.resolve(e.extensionPath,t),d=R.readdirSync(a),c=[];for(let f of d){let l;try{l=ie(W.join(a,f),o,s)}catch(Re){console.error(`Error while creating decoration type for icon: ${f}, error : ${Re}`);continue}if(!l)continue;let m=x.Uri.file(l),b=R.readFileSync(l),D=ae(b),y=F(),C=D.height??64,k=C<=y?(C-y/4)/2:-((C-y/4)/2);k=k+r;let X={position:"absolute",top:`${k}px`,"z-index":1,"pointer-events":"none"},Ae=A(X),Fe=x.window.createTextEditorDecorationType({after:{contentIconPath:m,textDecoration:`none; ${Ae}`,margin:"0 1rem"}});c.push(Fe)}return c}var E=S(require("vscode"));var di=F(),fi=di*.5,ui=115*fi,gi={position:"absolute","z-index":1,left:`${ui}px`},pi=A(gi);function B(e,t,i,n,r,o,s){if(e.languageId!=="rust")return;let a=[],d=E.window.activeTextEditor,c=[],f=!1,l=0;for(let m=0;m<e.lineCount;m++){let b=e.lineAt(m);if(b.text.trimStart().startsWith("//"))continue;if(s){let y=vi(b,f,l);if(f=y.inTestBlock,l=y.braceCount,y.shouldContinue)continue}let D=null;for(let[y,C]of Object.entries(Q))if(!r.includes(y.toLowerCase())&&b.text.includes(C)){D=C;break}if(D){let y=we[D],C=b.text.indexOf(D),k=new E.Range(m,C,m,b.text.length);c.push(k);let X=new E.Diagnostic(k,y,n);a.push(X)}}mi(d,c,pi,o,i,a,t,e)}function mi(e,t,i,n,r,o,s,a){if(e){r.forEach(c=>{e.setDecorations(c,[])});let d=r[Math.floor(Math.random()*r.length)];if(n){let c=t.map(f=>{let l=f.end.character>=105?"":i;return{range:f,renderOptions:{after:{textDecoration:l}}}});e.setDecorations(d,c)}else e.setDecorations(d,t);o.length===0?s.delete(a.uri):s.set(a.uri,o)}}function vi(e,t,i){if(e.text.includes("#[test]"))return t=!0,i=0,{inTestBlock:t,braceCount:i,shouldContinue:!0};if(t)for(let n of e.text)n==="{"?i++:n==="}"&&(i--,i===0&&(t=!1));return{inTestBlock:t,braceCount:i,shouldContinue:t}}function he(){let e=E.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.severity"),t;switch(e){case"Error":t=E.DiagnosticSeverity.Error;break;case"Information":t=E.DiagnosticSeverity.Information;break;case"Hint":t=E.DiagnosticSeverity.Hint;break;case"Warning":default:t=E.DiagnosticSeverity.Warning;break}return t}function wi(e){te();let t=g.languages.createDiagnosticCollection("rust-panic-highlighter");e.subscriptions.push(t);let i=g.workspace.getConfiguration().get("rustPanicHighlighter.icon.path")||"default",n=ne(e,i),r=[];de.default.lstatSync(n).isDirectory()?r=le(e,n):r=[ce(e,n)],r.forEach(c=>{e.subscriptions.push(c)});let o=he(),s=g.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoreInTestBlock",!0),a=g.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoredPanics",[]),d=g.workspace.getConfiguration().get("rustPanicHighlighter.icon.minXPositionEnabled",!0);g.workspace.textDocuments.forEach(c=>{c.languageId==="rust"&&B(c,t,r,o,a,d,s)}),g.workspace.onDidChangeTextDocument(c=>{c.document.languageId==="rust"&&B(c.document,t,r,o,a,d,s)}),g.workspace.onDidCloseTextDocument(c=>{c.languageId==="rust"&&t.delete(c.uri)}),g.window.onDidChangeActiveTextEditor(c=>{c&&c.document.languageId==="rust"&&B(c.document,t,r,o,a,d,s)}),g.workspace.onDidChangeConfiguration(c=>{c.affectsConfiguration("rustPanicHighlighter")&&(te(),r.forEach(f=>{f.dispose()}),i=g.workspace.getConfiguration().get("rustPanicHighlighter.icon.path")||"default",n=ne(e,i),de.default.lstatSync(n).isDirectory()?r=le(e,n):r=[ce(e,n)],r.forEach(f=>{e.subscriptions.push(f)}),o=he(),s=g.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoreInTestBlock",!0),a=g.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoredPanics",[]),d=g.workspace.getConfiguration().get("rustPanicHighlighter.icon.minXPositionEnabled",!0),g.workspace.textDocuments.forEach(f=>{f.languageId==="rust"&&B(f,t,r,o,a,d,s)}))})}function Ti(){}0&&(module.exports={activate,deactivate});
