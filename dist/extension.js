"use strict";var xt=Object.create;var F=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var Tt=Object.getOwnPropertyNames;var Ut=Object.getPrototypeOf,bt=Object.prototype.hasOwnProperty;var l=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),St=(e,t)=>{for(var n in t)F(e,n,{get:t[n],enumerable:!0})},Le=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Tt(t))!bt.call(e,i)&&i!==n&&F(e,i,{get:()=>t[i],enumerable:!(r=_t(t,i))||r.enumerable});return e};var U=(e,t,n)=>(n=e!=null?xt(Ut(e)):{},Le(t||!e||!e.__esModule?F(n,"default",{value:e,enumerable:!0}):n,e)),Pt=e=>Le(F({},"__esModule",{value:!0}),e);var je=l((gr,ce)=>{typeof Object.create=="function"?ce.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:ce.exports=function(t,n){if(n){t.super_=n;var r=function(){};r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t}}});var Oe=l((pr,de)=>{try{if(ae=require("util"),typeof ae.inherits!="function")throw"";de.exports=ae.inherits}catch{de.exports=je()}var ae});var De=l((mr,le)=>{var Ft=Oe(),Ce=require("events").EventEmitter;le.exports=v;le.exports.default=v;function v(e){if(!(this instanceof v))return new v(e);Ce.call(this),e=e||{},this.concurrency=e.concurrency||1/0,this.timeout=e.timeout||0,this.autostart=e.autostart||!1,this.results=e.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}Ft(v,Ce);var Bt=["pop","shift","indexOf","lastIndexOf"];Bt.forEach(function(e){v.prototype[e]=function(){return Array.prototype[e].apply(this.jobs,arguments)}});v.prototype.slice=function(e,t){return this.jobs=this.jobs.slice(e,t),this};v.prototype.reverse=function(){return this.jobs.reverse(),this};var Lt=["push","unshift","splice"];Lt.forEach(function(e){v.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this.autostart&&this.start(),t}});Object.defineProperty(v.prototype,"length",{get:function(){return this.pending+this.jobs.length}});v.prototype.start=function(e){if(e&&Ot.call(this,e),this.running=!0,this.pending>=this.concurrency)return;if(this.jobs.length===0){this.pending===0&&ue.call(this);return}var t=this,n=this.jobs.shift(),r=!0,i=this.session,o=null,a=!1,d=null,h=n.hasOwnProperty("timeout")?n.timeout:this.timeout;function u(p,w){r&&t.session===i&&(r=!1,t.pending--,o!==null&&(delete t.timers[o],clearTimeout(o)),p?t.emit("error",p,n):a===!1&&(d!==null&&(t.results[d]=Array.prototype.slice.call(arguments,1)),t.emit("success",w,n)),t.session===i&&(t.pending===0&&t.jobs.length===0?ue.call(t):t.running&&t.start()))}h&&(o=setTimeout(function(){a=!0,t.listeners("timeout").length>0?t.emit("timeout",u,n):u()},h),this.timers[o]=o),this.results&&(d=this.results.length,this.results[d]=null),this.pending++,t.emit("start",n);var f=n(u);f&&f.then&&typeof f.then=="function"&&f.then(function(p){return u(null,p)}).catch(function(p){return u(p||!0)}),this.running&&this.jobs.length>0&&this.start()};v.prototype.stop=function(){this.running=!1};v.prototype.end=function(e){jt.call(this),this.jobs.length=0,this.pending=0,ue.call(this,e)};function jt(){for(var e in this.timers){var t=this.timers[e];delete this.timers[e],clearTimeout(t)}}function Ot(e){var t=this;this.on("error",n),this.on("end",r);function n(i){t.end(i)}function r(i){t.removeListener("error",n),t.removeListener("end",r),e(i,this.results)}}function ue(e){this.session++,this.running=!1,this.emit("end",e)}});var g=l(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.findBox=s.readUInt=s.readUInt32LE=s.readUInt32BE=s.readInt32LE=s.readUInt24LE=s.readUInt16LE=s.readUInt16BE=s.readInt16LE=s.toHexString=s.toUTF8String=void 0;var Ct=new TextDecoder,Dt=(e,t=0,n=e.length)=>Ct.decode(e.slice(t,n));s.toUTF8String=Dt;var qt=(e,t=0,n=e.length)=>e.slice(t,n).reduce((r,i)=>r+("0"+i.toString(16)).slice(-2),"");s.toHexString=qt;var Mt=(e,t=0)=>{let n=e[t]+e[t+1]*256;return n|(n&2**15)*131070};s.readInt16LE=Mt;var Ht=(e,t=0)=>e[t]*2**8+e[t+1];s.readUInt16BE=Ht;var kt=(e,t=0)=>e[t]+e[t+1]*2**8;s.readUInt16LE=kt;var Nt=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16;s.readUInt24LE=Nt;var At=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16+(e[t+3]<<24);s.readInt32LE=At;var zt=(e,t=0)=>e[t]*2**24+e[t+1]*2**16+e[t+2]*2**8+e[t+3];s.readUInt32BE=zt;var Gt=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16+e[t+3]*2**24;s.readUInt32LE=Gt;var Rt={readUInt16BE:s.readUInt16BE,readUInt16LE:s.readUInt16LE,readUInt32BE:s.readUInt32BE,readUInt32LE:s.readUInt32LE};function $t(e,t,n,r){n=n||0;let i=r?"BE":"LE",o="readUInt"+t+i;return Rt[o](e,n)}s.readUInt=$t;function Wt(e,t){if(e.length-t<4)return;let n=(0,s.readUInt32BE)(e,t);if(!(e.length-t<n))return{name:(0,s.toUTF8String)(e,4+t,8+t),offset:t,size:n}}function Yt(e,t,n){for(;n<e.length;){let r=Wt(e,n);if(!r)break;if(r.name===t)return r;n+=r.size}}s.findBox=Yt});var qe=l(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.BMP=void 0;var he=g();B.BMP={validate:e=>(0,he.toUTF8String)(e,0,2)==="BM",calculate:e=>({height:Math.abs((0,he.readInt32LE)(e,22)),width:(0,he.readUInt32LE)(e,18)})}});var fe=l(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.ICO=void 0;var L=g(),Vt=1,Jt=6,Xt=16;function Me(e,t){let n=e[t];return n===0?256:n}function He(e,t){let n=Jt+t*Xt;return{height:Me(e,n+1),width:Me(e,n)}}j.ICO={validate(e){let t=(0,L.readUInt16LE)(e,0),n=(0,L.readUInt16LE)(e,4);return t!==0||n===0?!1:(0,L.readUInt16LE)(e,2)===Vt},calculate(e){let t=(0,L.readUInt16LE)(e,4),n=He(e,0);if(t===1)return n;let r=[n];for(let i=1;i<t;i+=1)r.push(He(e,i));return{height:n.height,images:r,width:n.width}}}});var ke=l(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.CUR=void 0;var Kt=fe(),ge=g(),Zt=2;O.CUR={validate(e){let t=(0,ge.readUInt16LE)(e,0),n=(0,ge.readUInt16LE)(e,4);return t!==0||n===0?!1:(0,ge.readUInt16LE)(e,2)===Zt},calculate:e=>Kt.ICO.calculate(e)}});var Ne=l(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.DDS=void 0;var pe=g();C.DDS={validate:e=>(0,pe.readUInt32LE)(e,0)===542327876,calculate:e=>({height:(0,pe.readUInt32LE)(e,12),width:(0,pe.readUInt32LE)(e,16)})}});var Ae=l(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.GIF=void 0;var me=g(),Qt=/^GIF8[79]a/;D.GIF={validate:e=>Qt.test((0,me.toUTF8String)(e,0,6)),calculate:e=>({height:(0,me.readUInt16LE)(e,8),width:(0,me.readUInt16LE)(e,6)})}});var ze=l(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.HEIF=void 0;var I=g(),en={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"};q.HEIF={validate(e){let t=(0,I.toUTF8String)(e,4,8),n=(0,I.toUTF8String)(e,8,12);return t==="ftyp"&&n in en},calculate(e){let t=(0,I.findBox)(e,"meta",0),n=t&&(0,I.findBox)(e,"iprp",t.offset+12),r=n&&(0,I.findBox)(e,"ipco",n.offset+8),i=r&&(0,I.findBox)(e,"ispe",r.offset+8);if(i)return{height:(0,I.readUInt32BE)(e,i.offset+16),width:(0,I.readUInt32BE)(e,i.offset+12),type:(0,I.toUTF8String)(e,8,12)};throw new TypeError("Invalid HEIF, no size found")}}});var $e=l(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.ICNS=void 0;var M=g(),tn=8,nn=4,rn=4,on={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024};function Ge(e,t){let n=t+rn;return[(0,M.toUTF8String)(e,t,n),(0,M.readUInt32BE)(e,n)]}function Re(e){let t=on[e];return{width:t,height:t,type:e}}H.ICNS={validate:e=>(0,M.toUTF8String)(e,0,4)==="icns",calculate(e){let t=e.length,n=(0,M.readUInt32BE)(e,nn),r=tn,i=Ge(e,r),o=Re(i[0]);if(r+=i[1],r===n)return o;let a={height:o.height,images:[o],width:o.width};for(;r<n&&r<t;)i=Ge(e,r),o=Re(i[0]),r+=i[1],a.images.push(o);return a}}});var We=l(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.J2C=void 0;var ve=g();k.J2C={validate:e=>(0,ve.toHexString)(e,0,4)==="ff4fff51",calculate:e=>({height:(0,ve.readUInt32BE)(e,12),width:(0,ve.readUInt32BE)(e,8)})}});var Ye=l(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.JP2=void 0;var x=g();N.JP2={validate(e){if((0,x.readUInt32BE)(e,4)!==1783636e3||(0,x.readUInt32BE)(e,0)<1)return!1;let t=(0,x.findBox)(e,"ftyp",0);return t?(0,x.readUInt32BE)(e,t.offset+4)===1718909296:!1},calculate(e){let t=(0,x.findBox)(e,"jp2h",0),n=t&&(0,x.findBox)(e,"ihdr",t.offset+8);if(n)return{height:(0,x.readUInt32BE)(e,n.offset+8),width:(0,x.readUInt32BE)(e,n.offset+12)};throw new TypeError("Unsupported JPEG 2000 format")}}});var Je=l(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.JPG=void 0;var E=g(),sn="45786966",cn=2,Ee=6,an=2,dn="4d4d",un="4949",Ve=12,ln=2;function hn(e){return(0,E.toHexString)(e,2,6)===sn}function fn(e,t){return{height:(0,E.readUInt16BE)(e,t),width:(0,E.readUInt16BE)(e,t+2)}}function gn(e,t){let r=Ee+8,i=(0,E.readUInt)(e,16,r,t);for(let o=0;o<i;o++){let a=r+ln+o*Ve,d=a+Ve;if(a>e.length)return;let h=e.slice(a,d);if((0,E.readUInt)(h,16,0,t)===274)return(0,E.readUInt)(h,16,2,t)!==3||(0,E.readUInt)(h,32,4,t)!==1?void 0:(0,E.readUInt)(h,16,8,t)}}function pn(e,t){let n=e.slice(cn,t),r=(0,E.toHexString)(n,Ee,Ee+an),i=r===dn;if(i||r===un)return gn(n,i)}function mn(e,t){if(t>e.length)throw new TypeError("Corrupt JPG, exceeded buffer limits")}A.JPG={validate:e=>(0,E.toHexString)(e,0,2)==="ffd8",calculate(e){e=e.slice(4);let t,n;for(;e.length;){let r=(0,E.readUInt16BE)(e,0);if(e[r]!==255){e=e.slice(1);continue}if(hn(e)&&(t=pn(e,r)),mn(e,r),n=e[r+1],n===192||n===193||n===194){let i=fn(e,r+5);return t?{height:i.height,orientation:t,width:i.width}:i}e=e.slice(r+2)}throw new TypeError("Invalid JPG, no size found")}}});var Xe=l(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.KTX=void 0;var Ie=g();z.KTX={validate:e=>{let t=(0,Ie.toUTF8String)(e,1,7);return["KTX 11","KTX 20"].includes(t)},calculate:e=>{let t=e[5]===49?"ktx":"ktx2",n=t==="ktx"?36:20;return{height:(0,Ie.readUInt32LE)(e,n+4),width:(0,Ie.readUInt32LE)(e,n),type:t}}}});var Ze=l(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.PNG=void 0;var _=g(),vn=`PNG\r

`,En="IHDR",Ke="CgBI";G.PNG={validate(e){if(vn===(0,_.toUTF8String)(e,1,8)){let t=(0,_.toUTF8String)(e,12,16);if(t===Ke&&(t=(0,_.toUTF8String)(e,28,32)),t!==En)throw new TypeError("Invalid PNG");return!0}return!1},calculate(e){return(0,_.toUTF8String)(e,12,16)===Ke?{height:(0,_.readUInt32BE)(e,36),width:(0,_.readUInt32BE)(e,32)}:{height:(0,_.readUInt32BE)(e,20),width:(0,_.readUInt32BE)(e,16)}}}});var tt=l(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.PNM=void 0;var ye=g(),Qe={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},et={default:e=>{let t=[];for(;e.length>0;){let n=e.shift();if(n[0]!=="#"){t=n.split(" ");break}}if(t.length===2)return{height:parseInt(t[1],10),width:parseInt(t[0],10)};throw new TypeError("Invalid PNM")},pam:e=>{let t={};for(;e.length>0;){let n=e.shift();if(n.length>16||n.charCodeAt(0)>128)continue;let[r,i]=n.split(" ");if(r&&i&&(t[r.toLowerCase()]=parseInt(i,10)),t.height&&t.width)break}if(t.height&&t.width)return{height:t.height,width:t.width};throw new TypeError("Invalid PAM")}};R.PNM={validate:e=>(0,ye.toUTF8String)(e,0,2)in Qe,calculate(e){let t=(0,ye.toUTF8String)(e,0,2),n=Qe[t],r=(0,ye.toUTF8String)(e,3).split(/[\r\n]+/);return(et[n]||et.default)(r)}}});var nt=l($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.PSD=void 0;var we=g();$.PSD={validate:e=>(0,we.toUTF8String)(e,0,4)==="8BPS",calculate:e=>({height:(0,we.readUInt32BE)(e,14),width:(0,we.readUInt32BE)(e,18)})}});var st=l(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.SVG=void 0;var rt=g(),it=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,W={height:/\sheight=(['"])([^%]+?)\1/,root:it,viewbox:/\sviewBox=(['"])(.+?)\1/i,width:/\swidth=(['"])([^%]+?)\1/},xe=2.54,ot={in:96,cm:96/xe,em:16,ex:8,m:96/xe*100,mm:96/xe/10,pc:96/72/12,pt:96/72,px:1},In=new RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(ot).join("|")})?$`);function Y(e){let t=In.exec(e);if(t)return Math.round(Number(t[1])*(ot[t[2]]||1))}function yn(e){let t=e.split(" ");return{height:Y(t[3]),width:Y(t[2])}}function wn(e){let t=e.match(W.width),n=e.match(W.height),r=e.match(W.viewbox);return{height:n&&Y(n[2]),viewbox:r&&yn(r[2]),width:t&&Y(t[2])}}function xn(e){return{height:e.height,width:e.width}}function _n(e,t){let n=t.width/t.height;return e.width?{height:Math.floor(e.width/n),width:e.width}:e.height?{height:e.height,width:Math.floor(e.height*n)}:{height:t.height,width:t.width}}V.SVG={validate:e=>it.test((0,rt.toUTF8String)(e,0,1e3)),calculate(e){let t=(0,rt.toUTF8String)(e).match(W.root);if(t){let n=wn(t[0]);if(n.width&&n.height)return xn(n);if(n.viewbox)return _n(n,n.viewbox)}throw new TypeError("Invalid SVG")}}});var ct=l(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.TGA=void 0;var J=g();X.TGA={validate(e){return(0,J.readUInt16LE)(e,0)===0&&(0,J.readUInt16LE)(e,4)===0},calculate(e){return{height:(0,J.readUInt16LE)(e,14),width:(0,J.readUInt16LE)(e,12)}}}});var at=l(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.TIFF=void 0;var K=require("fs"),T=g();function Tn(e,t,n){let r=(0,T.readUInt)(e,32,4,n),i=1024,o=K.statSync(t).size;r+i>o&&(i=o-r-10);let a=new Uint8Array(i),d=K.openSync(t,"r");return K.readSync(d,a,0,i,r),K.closeSync(d),a.slice(2)}function Un(e,t){let n=(0,T.readUInt)(e,16,8,t);return((0,T.readUInt)(e,16,10,t)<<16)+n}function bn(e){if(e.length>24)return e.slice(12)}function Sn(e,t){let n={},r=e;for(;r&&r.length;){let i=(0,T.readUInt)(r,16,0,t),o=(0,T.readUInt)(r,16,2,t),a=(0,T.readUInt)(r,32,4,t);if(i===0)break;a===1&&(o===3||o===4)&&(n[i]=Un(r,t)),r=bn(r)}return n}function Pn(e){let t=(0,T.toUTF8String)(e,0,2);if(t==="II")return"LE";if(t==="MM")return"BE"}var Fn=["49492a00","4d4d002a"];Z.TIFF={validate:e=>Fn.includes((0,T.toHexString)(e,0,4)),calculate(e,t){if(!t)throw new TypeError("Tiff doesn't support buffer");let n=Pn(e)==="BE",r=Tn(e,t,n),i=Sn(r,n),o=i[256],a=i[257];if(!o||!a)throw new TypeError("Invalid Tiff. Missing tags");return{height:a,width:o}}}});var dt=l(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.WEBP=void 0;var y=g();function Bn(e){return{height:1+(0,y.readUInt24LE)(e,7),width:1+(0,y.readUInt24LE)(e,4)}}function Ln(e){return{height:1+((e[4]&15)<<10|e[3]<<2|(e[2]&192)>>6),width:1+((e[2]&63)<<8|e[1])}}function jn(e){return{height:(0,y.readInt16LE)(e,8)&16383,width:(0,y.readInt16LE)(e,6)&16383}}Q.WEBP={validate(e){let t=(0,y.toUTF8String)(e,0,4)==="RIFF",n=(0,y.toUTF8String)(e,8,12)==="WEBP",r=(0,y.toUTF8String)(e,12,15)==="VP8";return t&&n&&r},calculate(e){let t=(0,y.toUTF8String)(e,12,16);if(e=e.slice(20,30),t==="VP8X"){let r=e[0],i=(r&192)===0,o=(r&1)===0;if(i&&o)return Bn(e);throw new TypeError("Invalid WebP")}if(t==="VP8 "&&e[0]!==47)return jn(e);let n=(0,y.toHexString)(e,3,6);if(t==="VP8L"&&n!=="9d012a")return Ln(e);throw new TypeError("Invalid WebP")}}});var _e=l(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.typeHandlers=void 0;var On=qe(),Cn=ke(),Dn=Ne(),qn=Ae(),Mn=ze(),Hn=$e(),kn=fe(),Nn=We(),An=Ye(),zn=Je(),Gn=Xe(),Rn=Ze(),$n=tt(),Wn=nt(),Yn=st(),Vn=ct(),Jn=at(),Xn=dt();ee.typeHandlers={bmp:On.BMP,cur:Cn.CUR,dds:Dn.DDS,gif:qn.GIF,heif:Mn.HEIF,icns:Hn.ICNS,ico:kn.ICO,j2c:Nn.J2C,jp2:An.JP2,jpg:zn.JPG,ktx:Gn.KTX,png:Rn.PNG,pnm:$n.PNM,psd:Wn.PSD,svg:Yn.SVG,tga:Vn.TGA,tiff:Jn.TIFF,webp:Xn.WEBP}});var lt=l(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.detector=void 0;var Te=_e(),Kn=Object.keys(Te.typeHandlers),ut={56:"psd",66:"bmp",68:"dds",71:"gif",73:"tiff",77:"tiff",82:"webp",105:"icns",137:"png",255:"jpg"};function Zn(e){let t=e[0];if(t in ut){let r=ut[t];if(r&&Te.typeHandlers[r].validate(e))return r}let n=r=>Te.typeHandlers[r].validate(e);return Kn.find(n)}te.detector=Zn});var pt=l((m,gt)=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.types=m.setConcurrency=m.disableTypes=m.disableFS=m.imageSize=void 0;var b=require("fs"),Qn=require("path"),er=De(),be=_e(),tr=lt(),ht=512*1024,ft=new er.default({concurrency:100,autostart:!0}),ne={disabledFS:!1,disabledTypes:[]};function Ue(e,t){let n=(0,tr.detector)(e);if(typeof n<"u"){if(ne.disabledTypes.indexOf(n)>-1)throw new TypeError("disabled file type: "+n);if(n in be.typeHandlers){let r=be.typeHandlers[n].calculate(e,t);if(r!==void 0)return r.type=r.type??n,r}}throw new TypeError("unsupported file type: "+n+" (file: "+t+")")}async function nr(e){let t=await b.promises.open(e,"r");try{let{size:n}=await t.stat();if(n<=0)throw new Error("Empty file");let r=Math.min(n,ht),i=new Uint8Array(r);return await t.read(i,0,r,0),i}finally{await t.close()}}function rr(e){let t=b.openSync(e,"r");try{let{size:n}=b.fstatSync(t);if(n<=0)throw new Error("Empty file");let r=Math.min(n,ht),i=new Uint8Array(r);return b.readSync(t,i,0,r,0),i}finally{b.closeSync(t)}}gt.exports=m=Se;m.default=Se;function Se(e,t){if(e instanceof Uint8Array)return Ue(e);if(typeof e!="string"||ne.disabledFS)throw new TypeError("invalid invocation. input should be a Uint8Array");let n=Qn.resolve(e);if(typeof t=="function")ft.push(()=>nr(n).then(r=>process.nextTick(t,null,Ue(r,n))).catch(t));else{let r=rr(n);return Ue(r,n)}}m.imageSize=Se;var ir=e=>{ne.disabledFS=e};m.disableFS=ir;var or=e=>{ne.disabledTypes=e};m.disableTypes=or;var sr=e=>{ft.concurrency=e};m.setConcurrency=sr;m.types=Object.keys(be.typeHandlers)});var hr={};St(hr,{activate:()=>ur,deactivate:()=>lr,defaultAdjustTopPosition:()=>It,defaultIconHeight:()=>Be,defaultIconPath:()=>vt,defaultIconWidth:()=>Et});module.exports=Pt(hr);var c=U(require("vscode")),S=U(require("fs")),re=U(require("path")),Fe=U(require("os")),mt=U(pt()),vt="resources/panic-icon.gif",Et=64,Be=64,It=0;function cr(e){let t="";return Object.keys(e).map(r=>{if(t=e[r],typeof t=="string"||typeof t=="number")return`${r}: ${t};`}).join(" ")}function ar(){let e=c.workspace.getConfiguration("editor"),t=e.get("fontSize")||14,n=e.get("lineHeight")||0,r;return n===0?r=t:n>0&&n<8?r=t*n:r=n,r}var dr=(e,t,n)=>{let r=re.default.extname(e).toLowerCase();if([".gif",".png",".jpg",".jpeg",".svg"].includes(r)){if(r===".svg")try{let a=S.default.readFileSync(e,"utf8").replace(/<svg([^>]*)>/,(u,f)=>{let p=/width\s*=\s*["'].*?["']/.test(f),w=/height\s*=\s*["'].*?["']/.test(f);return`<svg${f+(p?"":` width="${t}"`)+(w?"":` height="${n}"`)}>`}),d=Fe.default.tmpdir(),h=re.default.join(d,"icon_tmp.svg");return S.default.writeFileSync(h,a,"utf8"),h}catch(o){throw console.error("Erreur lors du traitement du fichier SVG:",o),new Error(`Impossible de traiter le fichier SVG : ${e}`)}try{let a=S.default.readFileSync(e).toString("base64"),d="";switch(r){case".gif":d="image/gif";break;case".png":d="image/png";break;case".jpg":case".jpeg":d="image/jpeg";break;default:throw new Error(`Format d'image non pris en charge : ${r}`)}let h=`
            <svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${n}">
                <image href="data:${d};base64,${a}" width="${t}" height="${n}"/>
            </svg>
        `,u=Fe.default.tmpdir(),f=re.default.join(u,"icon_tmp.svg");return S.default.writeFileSync(f,h,"utf8"),f}catch(o){throw console.error("Une erreur est survenue lors du traitement de l'ic\xF4ne :",o),new Error("Une erreur est survenue lors du traitement de l'ic\xF4ne.")}}return e};function ur(e){let t=c.languages.createDiagnosticCollection("rust-panic-highlighter");e.subscriptions.push(t);function n(){if(!(c.workspace.getConfiguration().get("icon.enabled")??!0))return c.window.createTextEditorDecorationType({});let o=c.workspace.getConfiguration().get("icon.path")||"default";o==="default"&&(o=e.asAbsolutePath(vt));let a=c.workspace.getConfiguration().get("icon.width")||Et,d=c.workspace.getConfiguration().get("icon.height")||Be,h=c.workspace.getConfiguration().get("icon.adjustTopPosition")||It;if(a!==void 0&&a<=0)throw new Error("icon.width must be a positive number.");if(d!==void 0&&d<=0)throw new Error("icon.height must be a positive number.");let u=`${a}px`,f=`${d}px`,p=dr(o,u,f),w=(0,mt.default)(p),P=c.Uri.file(p),ie=ar(),oe=w.height??Be,se=oe<=ie?(oe-ie/4)/2:-((oe-ie/4)/2);se=se+h;let yt={position:"absolute",top:`${se}px`,"z-index":1,"pointer-events":"none"},wt=cr(yt);return c.window.createTextEditorDecorationType({after:{contentIconPath:P,textDecoration:`none; ${wt}`,margin:"0 1rem"}})}let r=n();e.subscriptions.push(r),c.workspace.onDidOpenTextDocument(i=>{i.languageId==="rust"&&Pe(i,t,r)}),c.workspace.onDidChangeTextDocument(i=>{i.document.languageId==="rust"&&Pe(i.document,t,r)}),c.workspace.onDidCloseTextDocument(i=>{i.languageId==="rust"&&t.delete(i.uri)}),c.workspace.onDidChangeConfiguration(i=>{(i.affectsConfiguration("icon.enabled")||i.affectsConfiguration("icon.path")||i.affectsConfiguration("icon.width")||i.affectsConfiguration("icon.height")||i.affectsConfiguration("icon.adjustTopPosition"))&&(r.dispose(),r=n(),e.subscriptions.push(r),c.workspace.textDocuments.forEach(o=>{o.languageId==="rust"&&Pe(o,t,r)}))})}function Pe(e,t,n){let r=[],i=c.window.activeTextEditor,o=[],a=c.workspace.getConfiguration().get("diagnostic.severity"),d;switch(a){case"Error":d=c.DiagnosticSeverity.Error;break;case"Information":d=c.DiagnosticSeverity.Information;break;case"Hint":d=c.DiagnosticSeverity.Hint;break;case"Warning":default:d=c.DiagnosticSeverity.Warning;break}for(let h=0;h<e.lineCount;h++){let u=e.lineAt(h);if(!u.text.trimStart().startsWith("//")&&(u.text.includes("panic!(")||u.text.includes("unwrap(")||u.text.includes("expect("))){let f="";u.text.includes("panic!(")?f="This line contains a 'panic!' which can cause a runtime panic.":u.text.includes("unwrap(")?f="This line contains an 'unwrap()', which will panic if the result is None or Err.":u.text.includes("expect(")&&(f="This line contains an 'expect()', which will panic if the result is None or Err.");let p=0;u.text.includes("panic!(")?p=u.text.indexOf("panic!("):u.text.includes("unwrap(")?p=u.text.indexOf("unwrap("):u.text.includes("expect(")&&(p=u.text.indexOf("expect("));let w=new c.Range(h,p,h,u.text.length);o.push(w);let P=new c.Diagnostic(w,f,d);r.push(P)}}i&&(o.length>0?i.setDecorations(n,o):i.setDecorations(n,[])),r.length===0?t.delete(e.uri):t.set(e.uri,r)}function lr(){}0&&(module.exports={activate,deactivate,defaultAdjustTopPosition,defaultIconHeight,defaultIconPath,defaultIconWidth});
