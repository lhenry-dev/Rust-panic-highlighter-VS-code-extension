"use strict";var Kt=Object.create;var z=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var en=Object.getPrototypeOf,tn=Object.prototype.hasOwnProperty;var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nn=(e,t)=>{for(var n in t)z(e,n,{get:t[n],enumerable:!0})},et=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Qt(t))!tn.call(e,r)&&r!==n&&z(e,r,{get:()=>t[r],enumerable:!(i=Zt(t,r))||i.enumerable});return e};var T=(e,t,n)=>(n=e!=null?Kt(en(e)):{},et(t||!e||!e.__esModule?z(n,"default",{value:e,enumerable:!0}):n,e)),rn=e=>et(z({},"__esModule",{value:!0}),e);var at=h((ur,Ue)=>{typeof Object.create=="function"?Ue.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Ue.exports=function(t,n){if(n){t.super_=n;var i=function(){};i.prototype=n.prototype,t.prototype=new i,t.prototype.constructor=t}}});var dt=h((lr,Ce)=>{try{if(De=require("util"),typeof De.inherits!="function")throw"";Ce.exports=De.inherits}catch{Ce.exports=at()}var De});var lt=h((hr,Le)=>{var sn=dt(),ut=require("events").EventEmitter;Le.exports=E;Le.exports.default=E;function E(e){if(!(this instanceof E))return new E(e);ut.call(this),e=e||{},this.concurrency=e.concurrency||1/0,this.timeout=e.timeout||0,this.autostart=e.autostart||!1,this.results=e.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}sn(E,ut);var cn=["pop","shift","indexOf","lastIndexOf"];cn.forEach(function(e){E.prototype[e]=function(){return Array.prototype[e].apply(this.jobs,arguments)}});E.prototype.slice=function(e,t){return this.jobs=this.jobs.slice(e,t),this};E.prototype.reverse=function(){return this.jobs.reverse(),this};var an=["push","unshift","splice"];an.forEach(function(e){E.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this.autostart&&this.start(),t}});Object.defineProperty(E.prototype,"length",{get:function(){return this.pending+this.jobs.length}});E.prototype.start=function(e){if(e&&un.call(this,e),this.running=!0,this.pending>=this.concurrency)return;if(this.jobs.length===0){this.pending===0&&Fe.call(this);return}var t=this,n=this.jobs.shift(),i=!0,r=this.session,o=null,s=!1,u=null,f=n.hasOwnProperty("timeout")?n.timeout:this.timeout;function c(a,v){i&&t.session===r&&(i=!1,t.pending--,o!==null&&(delete t.timers[o],clearTimeout(o)),a?t.emit("error",a,n):s===!1&&(u!==null&&(t.results[u]=Array.prototype.slice.call(arguments,1)),t.emit("success",v,n)),t.session===r&&(t.pending===0&&t.jobs.length===0?Fe.call(t):t.running&&t.start()))}f&&(o=setTimeout(function(){s=!0,t.listeners("timeout").length>0?t.emit("timeout",c,n):c()},f),this.timers[o]=o),this.results&&(u=this.results.length,this.results[u]=null),this.pending++,t.emit("start",n);var l=n(c);l&&l.then&&typeof l.then=="function"&&l.then(function(a){return c(null,a)}).catch(function(a){return c(a||!0)}),this.running&&this.jobs.length>0&&this.start()};E.prototype.stop=function(){this.running=!1};E.prototype.end=function(e){dn.call(this),this.jobs.length=0,this.pending=0,Fe.call(this,e)};function dn(){for(var e in this.timers){var t=this.timers[e];delete this.timers[e],clearTimeout(t)}}function un(e){var t=this;this.on("error",n),this.on("end",i);function n(r){t.end(r)}function i(r){t.removeListener("error",n),t.removeListener("end",i),e(r,this.results)}}function Fe(e){this.session++,this.running=!1,this.emit("end",e)}});var g=h(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.findBox=d.readUInt=d.readUInt32LE=d.readUInt32BE=d.readInt32LE=d.readUInt24LE=d.readUInt16LE=d.readUInt16BE=d.readInt16LE=d.toHexString=d.toUTF8String=void 0;var ln=new TextDecoder,hn=(e,t=0,n=e.length)=>ln.decode(e.slice(t,n));d.toUTF8String=hn;var fn=(e,t=0,n=e.length)=>e.slice(t,n).reduce((i,r)=>i+("0"+r.toString(16)).slice(-2),"");d.toHexString=fn;var gn=(e,t=0)=>{let n=e[t]+e[t+1]*256;return n|(n&2**15)*131070};d.readInt16LE=gn;var pn=(e,t=0)=>e[t]*2**8+e[t+1];d.readUInt16BE=pn;var mn=(e,t=0)=>e[t]+e[t+1]*2**8;d.readUInt16LE=mn;var vn=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16;d.readUInt24LE=vn;var yn=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16+(e[t+3]<<24);d.readInt32LE=yn;var wn=(e,t=0)=>e[t]*2**24+e[t+1]*2**16+e[t+2]*2**8+e[t+3];d.readUInt32BE=wn;var En=(e,t=0)=>e[t]+e[t+1]*2**8+e[t+2]*2**16+e[t+3]*2**24;d.readUInt32LE=En;var xn={readUInt16BE:d.readUInt16BE,readUInt16LE:d.readUInt16LE,readUInt32BE:d.readUInt32BE,readUInt32LE:d.readUInt32LE};function In(e,t,n,i){n=n||0;let r=i?"BE":"LE",o="readUInt"+t+r;return xn[o](e,n)}d.readUInt=In;function Tn(e,t){if(e.length-t<4)return;let n=(0,d.readUInt32BE)(e,t);if(!(e.length-t<n))return{name:(0,d.toUTF8String)(e,4+t,8+t),offset:t,size:n}}function _n(e,t,n){for(;n<e.length;){let i=Tn(e,n);if(!i)break;if(i.name===t)return i;n+=i.size}}d.findBox=_n});var ht=h(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.BMP=void 0;var je=g();G.BMP={validate:e=>(0,je.toUTF8String)(e,0,2)==="BM",calculate:e=>({height:Math.abs((0,je.readInt32LE)(e,22)),width:(0,je.readUInt32LE)(e,18)})}});var Be=h(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.ICO=void 0;var $=g(),Sn=1,bn=6,Pn=16;function ft(e,t){let n=e[t];return n===0?256:n}function gt(e,t){let n=bn+t*Pn;return{height:ft(e,n+1),width:ft(e,n)}}V.ICO={validate(e){let t=(0,$.readUInt16LE)(e,0),n=(0,$.readUInt16LE)(e,4);return t!==0||n===0?!1:(0,$.readUInt16LE)(e,2)===Sn},calculate(e){let t=(0,$.readUInt16LE)(e,4),n=gt(e,0);if(t===1)return n;let i=[n];for(let r=1;r<t;r+=1)i.push(gt(e,r));return{height:n.height,images:i,width:n.width}}}});var pt=h(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.CUR=void 0;var Un=Be(),He=g(),Dn=2;W.CUR={validate(e){let t=(0,He.readUInt16LE)(e,0),n=(0,He.readUInt16LE)(e,4);return t!==0||n===0?!1:(0,He.readUInt16LE)(e,2)===Dn},calculate:e=>Un.ICO.calculate(e)}});var mt=h(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.DDS=void 0;var ke=g();X.DDS={validate:e=>(0,ke.readUInt32LE)(e,0)===542327876,calculate:e=>({height:(0,ke.readUInt32LE)(e,12),width:(0,ke.readUInt32LE)(e,16)})}});var vt=h(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.GIF=void 0;var Oe=g(),Cn=/^GIF8[79]a/;Y.GIF={validate:e=>Cn.test((0,Oe.toUTF8String)(e,0,6)),calculate:e=>({height:(0,Oe.readUInt16LE)(e,8),width:(0,Oe.readUInt16LE)(e,6)})}});var yt=h(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.HEIF=void 0;var U=g(),Fn={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"};J.HEIF={validate(e){let t=(0,U.toUTF8String)(e,4,8),n=(0,U.toUTF8String)(e,8,12);return t==="ftyp"&&n in Fn},calculate(e){let t=(0,U.findBox)(e,"meta",0),n=t&&(0,U.findBox)(e,"iprp",t.offset+12),i=n&&(0,U.findBox)(e,"ipco",n.offset+8),r=i&&(0,U.findBox)(e,"ispe",i.offset+8);if(r)return{height:(0,U.readUInt32BE)(e,r.offset+16),width:(0,U.readUInt32BE)(e,r.offset+12),type:(0,U.toUTF8String)(e,8,12)};throw new TypeError("Invalid HEIF, no size found")}}});var xt=h(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.ICNS=void 0;var K=g(),Ln=8,jn=4,Bn=4,Hn={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024};function wt(e,t){let n=t+Bn;return[(0,K.toUTF8String)(e,t,n),(0,K.readUInt32BE)(e,n)]}function Et(e){let t=Hn[e];return{width:t,height:t,type:e}}Z.ICNS={validate:e=>(0,K.toUTF8String)(e,0,4)==="icns",calculate(e){let t=e.length,n=(0,K.readUInt32BE)(e,jn),i=Ln,r=wt(e,i),o=Et(r[0]);if(i+=r[1],i===n)return o;let s={height:o.height,images:[o],width:o.width};for(;i<n&&i<t;)r=wt(e,i),o=Et(r[0]),i+=r[1],s.images.push(o);return s}}});var It=h(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.J2C=void 0;var qe=g();Q.J2C={validate:e=>(0,qe.toHexString)(e,0,4)==="ff4fff51",calculate:e=>({height:(0,qe.readUInt32BE)(e,12),width:(0,qe.readUInt32BE)(e,8)})}});var Tt=h(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.JP2=void 0;var F=g();ee.JP2={validate(e){if((0,F.readUInt32BE)(e,4)!==1783636e3||(0,F.readUInt32BE)(e,0)<1)return!1;let t=(0,F.findBox)(e,"ftyp",0);return t?(0,F.readUInt32BE)(e,t.offset+4)===1718909296:!1},calculate(e){let t=(0,F.findBox)(e,"jp2h",0),n=t&&(0,F.findBox)(e,"ihdr",t.offset+8);if(n)return{height:(0,F.readUInt32BE)(e,n.offset+8),width:(0,F.readUInt32BE)(e,n.offset+12)};throw new TypeError("Unsupported JPEG 2000 format")}}});var St=h(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.JPG=void 0;var _=g(),kn="45786966",On=2,Me=6,qn=2,Mn="4d4d",Nn="4949",_t=12,zn=2;function An(e){return(0,_.toHexString)(e,2,6)===kn}function Rn(e,t){return{height:(0,_.readUInt16BE)(e,t),width:(0,_.readUInt16BE)(e,t+2)}}function Gn(e,t){let i=Me+8,r=(0,_.readUInt)(e,16,i,t);for(let o=0;o<r;o++){let s=i+zn+o*_t,u=s+_t;if(s>e.length)return;let f=e.slice(s,u);if((0,_.readUInt)(f,16,0,t)===274)return(0,_.readUInt)(f,16,2,t)!==3||(0,_.readUInt)(f,32,4,t)!==1?void 0:(0,_.readUInt)(f,16,8,t)}}function $n(e,t){let n=e.slice(On,t),i=(0,_.toHexString)(n,Me,Me+qn),r=i===Mn;if(r||i===Nn)return Gn(n,r)}function Vn(e,t){if(t>e.length)throw new TypeError("Corrupt JPG, exceeded buffer limits")}te.JPG={validate:e=>(0,_.toHexString)(e,0,2)==="ffd8",calculate(e){e=e.slice(4);let t,n;for(;e.length;){let i=(0,_.readUInt16BE)(e,0);if(e[i]!==255){e=e.slice(1);continue}if(An(e)&&(t=$n(e,i)),Vn(e,i),n=e[i+1],n===192||n===193||n===194){let r=Rn(e,i+5);return t?{height:r.height,orientation:t,width:r.width}:r}e=e.slice(i+2)}throw new TypeError("Invalid JPG, no size found")}}});var bt=h(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.KTX=void 0;var Ne=g();ne.KTX={validate:e=>{let t=(0,Ne.toUTF8String)(e,1,7);return["KTX 11","KTX 20"].includes(t)},calculate:e=>{let t=e[5]===49?"ktx":"ktx2",n=t==="ktx"?36:20;return{height:(0,Ne.readUInt32LE)(e,n+4),width:(0,Ne.readUInt32LE)(e,n),type:t}}}});var Ut=h(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.PNG=void 0;var L=g(),Wn=`PNG\r

`,Xn="IHDR",Pt="CgBI";ie.PNG={validate(e){if(Wn===(0,L.toUTF8String)(e,1,8)){let t=(0,L.toUTF8String)(e,12,16);if(t===Pt&&(t=(0,L.toUTF8String)(e,28,32)),t!==Xn)throw new TypeError("Invalid PNG");return!0}return!1},calculate(e){return(0,L.toUTF8String)(e,12,16)===Pt?{height:(0,L.readUInt32BE)(e,36),width:(0,L.readUInt32BE)(e,32)}:{height:(0,L.readUInt32BE)(e,20),width:(0,L.readUInt32BE)(e,16)}}}});var Ft=h(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.PNM=void 0;var ze=g(),Dt={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},Ct={default:e=>{let t=[];for(;e.length>0;){let n=e.shift();if(n[0]!=="#"){t=n.split(" ");break}}if(t.length===2)return{height:parseInt(t[1],10),width:parseInt(t[0],10)};throw new TypeError("Invalid PNM")},pam:e=>{let t={};for(;e.length>0;){let n=e.shift();if(n.length>16||n.charCodeAt(0)>128)continue;let[i,r]=n.split(" ");if(i&&r&&(t[i.toLowerCase()]=parseInt(r,10)),t.height&&t.width)break}if(t.height&&t.width)return{height:t.height,width:t.width};throw new TypeError("Invalid PAM")}};re.PNM={validate:e=>(0,ze.toUTF8String)(e,0,2)in Dt,calculate(e){let t=(0,ze.toUTF8String)(e,0,2),n=Dt[t],i=(0,ze.toUTF8String)(e,3).split(/[\r\n]+/);return(Ct[n]||Ct.default)(i)}}});var Lt=h(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.PSD=void 0;var Ae=g();oe.PSD={validate:e=>(0,Ae.toUTF8String)(e,0,4)==="8BPS",calculate:e=>({height:(0,Ae.readUInt32BE)(e,14),width:(0,Ae.readUInt32BE)(e,18)})}});var kt=h(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.SVG=void 0;var jt=g(),Bt=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,se={height:/\sheight=(['"])([^%]+?)\1/,root:Bt,viewbox:/\sviewBox=(['"])(.+?)\1/i,width:/\swidth=(['"])([^%]+?)\1/},Re=2.54,Ht={in:96,cm:96/Re,em:16,ex:8,m:96/Re*100,mm:96/Re/10,pc:96/72/12,pt:96/72,px:1},Yn=new RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(Ht).join("|")})?$`);function ce(e){let t=Yn.exec(e);if(t)return Math.round(Number(t[1])*(Ht[t[2]]||1))}function Jn(e){let t=e.split(" ");return{height:ce(t[3]),width:ce(t[2])}}function Kn(e){let t=e.match(se.width),n=e.match(se.height),i=e.match(se.viewbox);return{height:n&&ce(n[2]),viewbox:i&&Jn(i[2]),width:t&&ce(t[2])}}function Zn(e){return{height:e.height,width:e.width}}function Qn(e,t){let n=t.width/t.height;return e.width?{height:Math.floor(e.width/n),width:e.width}:e.height?{height:e.height,width:Math.floor(e.height*n)}:{height:t.height,width:t.width}}ae.SVG={validate:e=>Bt.test((0,jt.toUTF8String)(e,0,1e3)),calculate(e){let t=(0,jt.toUTF8String)(e).match(se.root);if(t){let n=Kn(t[0]);if(n.width&&n.height)return Zn(n);if(n.viewbox)return Qn(n,n.viewbox)}throw new TypeError("Invalid SVG")}}});var Ot=h(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.TGA=void 0;var de=g();ue.TGA={validate(e){return(0,de.readUInt16LE)(e,0)===0&&(0,de.readUInt16LE)(e,4)===0},calculate(e){return{height:(0,de.readUInt16LE)(e,14),width:(0,de.readUInt16LE)(e,12)}}}});var qt=h(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.TIFF=void 0;var le=require("fs"),j=g();function ei(e,t,n){let i=(0,j.readUInt)(e,32,4,n),r=1024,o=le.statSync(t).size;i+r>o&&(r=o-i-10);let s=new Uint8Array(r),u=le.openSync(t,"r");return le.readSync(u,s,0,r,i),le.closeSync(u),s.slice(2)}function ti(e,t){let n=(0,j.readUInt)(e,16,8,t);return((0,j.readUInt)(e,16,10,t)<<16)+n}function ni(e){if(e.length>24)return e.slice(12)}function ii(e,t){let n={},i=e;for(;i&&i.length;){let r=(0,j.readUInt)(i,16,0,t),o=(0,j.readUInt)(i,16,2,t),s=(0,j.readUInt)(i,32,4,t);if(r===0)break;s===1&&(o===3||o===4)&&(n[r]=ti(i,t)),i=ni(i)}return n}function ri(e){let t=(0,j.toUTF8String)(e,0,2);if(t==="II")return"LE";if(t==="MM")return"BE"}var oi=["49492a00","4d4d002a"];he.TIFF={validate:e=>oi.includes((0,j.toHexString)(e,0,4)),calculate(e,t){if(!t)throw new TypeError("Tiff doesn't support buffer");let n=ri(e)==="BE",i=ei(e,t,n),r=ii(i,n),o=r[256],s=r[257];if(!o||!s)throw new TypeError("Invalid Tiff. Missing tags");return{height:s,width:o}}}});var Mt=h(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.WEBP=void 0;var D=g();function si(e){return{height:1+(0,D.readUInt24LE)(e,7),width:1+(0,D.readUInt24LE)(e,4)}}function ci(e){return{height:1+((e[4]&15)<<10|e[3]<<2|(e[2]&192)>>6),width:1+((e[2]&63)<<8|e[1])}}function ai(e){return{height:(0,D.readInt16LE)(e,8)&16383,width:(0,D.readInt16LE)(e,6)&16383}}fe.WEBP={validate(e){let t=(0,D.toUTF8String)(e,0,4)==="RIFF",n=(0,D.toUTF8String)(e,8,12)==="WEBP",i=(0,D.toUTF8String)(e,12,15)==="VP8";return t&&n&&i},calculate(e){let t=(0,D.toUTF8String)(e,12,16);if(e=e.slice(20,30),t==="VP8X"){let i=e[0],r=(i&192)===0,o=(i&1)===0;if(r&&o)return si(e);throw new TypeError("Invalid WebP")}if(t==="VP8 "&&e[0]!==47)return ai(e);let n=(0,D.toHexString)(e,3,6);if(t==="VP8L"&&n!=="9d012a")return ci(e);throw new TypeError("Invalid WebP")}}});var Ge=h(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.typeHandlers=void 0;var di=ht(),ui=pt(),li=mt(),hi=vt(),fi=yt(),gi=xt(),pi=Be(),mi=It(),vi=Tt(),yi=St(),wi=bt(),Ei=Ut(),xi=Ft(),Ii=Lt(),Ti=kt(),_i=Ot(),Si=qt(),bi=Mt();ge.typeHandlers={bmp:di.BMP,cur:ui.CUR,dds:li.DDS,gif:hi.GIF,heif:fi.HEIF,icns:gi.ICNS,ico:pi.ICO,j2c:mi.J2C,jp2:vi.JP2,jpg:yi.JPG,ktx:wi.KTX,png:Ei.PNG,pnm:xi.PNM,psd:Ii.PSD,svg:Ti.SVG,tga:_i.TGA,tiff:Si.TIFF,webp:bi.WEBP}});var zt=h(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.detector=void 0;var $e=Ge(),Pi=Object.keys($e.typeHandlers),Nt={56:"psd",66:"bmp",68:"dds",71:"gif",73:"tiff",77:"tiff",82:"webp",105:"icns",137:"png",255:"jpg"};function Ui(e){let t=e[0];if(t in Nt){let i=Nt[t];if(i&&$e.typeHandlers[i].validate(e))return i}let n=i=>$e.typeHandlers[i].validate(e);return Pi.find(n)}pe.detector=Ui});var $t=h((y,Gt)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.types=y.setConcurrency=y.disableTypes=y.disableFS=y.imageSize=void 0;var q=require("fs"),Di=require("path"),Ci=lt(),We=Ge(),Fi=zt(),At=512*1024,Rt=new Ci.default({concurrency:100,autostart:!0}),me={disabledFS:!1,disabledTypes:[]};function Ve(e,t){let n=(0,Fi.detector)(e);if(typeof n<"u"){if(me.disabledTypes.indexOf(n)>-1)throw new TypeError("disabled file type: "+n);if(n in We.typeHandlers){let i=We.typeHandlers[n].calculate(e,t);if(i!==void 0)return i.type=i.type??n,i}}throw new TypeError("unsupported file type: "+n+" (file: "+t+")")}async function Li(e){let t=await q.promises.open(e,"r");try{let{size:n}=await t.stat();if(n<=0)throw new Error("Empty file");let i=Math.min(n,At),r=new Uint8Array(i);return await t.read(r,0,i,0),r}finally{await t.close()}}function ji(e){let t=q.openSync(e,"r");try{let{size:n}=q.fstatSync(t);if(n<=0)throw new Error("Empty file");let i=Math.min(n,At),r=new Uint8Array(i);return q.readSync(t,r,0,i,0),r}finally{q.closeSync(t)}}Gt.exports=y=Xe;y.default=Xe;function Xe(e,t){if(e instanceof Uint8Array)return Ve(e);if(typeof e!="string"||me.disabledFS)throw new TypeError("invalid invocation. input should be a Uint8Array");let n=Di.resolve(e);if(typeof t=="function")Rt.push(()=>Li(n).then(i=>process.nextTick(t,null,Ve(i,n))).catch(t));else{let i=ji(n);return Ve(i,n)}}y.imageSize=Xe;var Bi=e=>{me.disabledFS=e};y.disableFS=Bi;var Hi=e=>{me.disabledTypes=e};y.disableTypes=Hi;var ki=e=>{Rt.concurrency=e};y.setConcurrency=ki;y.types=Object.keys(We.typeHandlers)});var Yi={};nn(Yi,{activate:()=>Wi,deactivate:()=>Xi});module.exports=rn(Yi);var p=T(require("vscode")),Qe=T(require("fs"));var w=T(require("vscode")),Wt=T(require("fs")),ye=T(require("path"));var ct=T(require("vscode")),P=T(require("fs")),B=T(require("path")),_e=T(require("os"));var m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function tt(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}var nt=require("crypto"),R=new Uint8Array(256),A=R.length;function Ee(){return A>R.length-16&&((0,nt.randomFillSync)(R),A=0),R.slice(A,A+=16)}var it=require("crypto"),xe={randomUUID:it.randomUUID};function on(e,t,n){if(xe.randomUUID&&!t&&!e)return xe.randomUUID();e=e||{};let i=e.random||(e.rng||Ee)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){n=n||0;for(let r=0;r<16;++r)t[n+r]=i[r];return t}return tt(i)}var Ie=on;var rt="rustPanicHighlighter_icon_tmp",H="resources/panic-icon.gif";var ot=[".gif",".png",".jpg",".jpeg",".svg"],Te="RustPanicHighlighter";function k(e){let t="";return Object.keys(e).map(i=>{if(t=String(e[i]),typeof t=="string"||typeof t=="number")return`${i}: ${t};`}).join(" ")}function O(){let e=ct.workspace.getConfiguration("editor"),t=e.get("fontSize")||14,n=e.get("lineHeight")||0,i;return n===0?i=t:n>0&&n<8?i=t*n:i=n,i}function st(e){let t=_e.default.tmpdir(),n=B.default.join(t,Te),i=Ie(),r=B.default.join(n,`${rt}_${i}.svg`);return P.default.writeFileSync(r,e,"utf8"),r}function Se(){let e=_e.default.tmpdir(),t=B.default.join(e,Te);P.default.existsSync(t)?P.default.readdirSync(t).forEach(i=>{let r=B.default.join(t,i);P.default.lstatSync(r).isFile()&&P.default.unlinkSync(r)}):P.default.mkdirSync(t)}function be(e,t,n){let i=B.default.extname(e).toLowerCase();if(!ot.includes(i))throw new Error(`Unsupported image format: ${i}`);try{if(i===".svg"){let c=P.default.readFileSync(e,"utf8").replace(/<svg([^>]*)>/,(l,a)=>`<svg${a+(/<width\s*=\s*["'].*?["']/.test(a)?"":` width="${t}"`)+(/<height\s*=\s*["'].*?["']/.test(a)?"":` height="${n}"`)}>`);return st(c)}let o=P.default.readFileSync(e).toString("base64"),s;switch(i){case".gif":s="image/gif";break;case".png":s="image/png";break;case".jpg":case".jpeg":s="image/jpeg";break;default:throw new Error(`Unsupported image format: ${i}`)}let u=`
            <svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${n}">
                <image href="data:${s};base64,${o}" width="${t}" height="${n}"/>
            </svg>
        `;return st(u)}catch(r){throw console.error("An error occurred while processing the icon:",r),new Error(`An error occurred while processing the icon: ${e}`)}}function Pe(e,t){return t==="default"?e.asAbsolutePath(H):t}var Ye=T($t());function Je(e,t){if(!(w.workspace.getConfiguration().get("rustPanicHighlighter.icon.enabled")??!0))return w.window.createTextEditorDecorationType({});t==="default"&&(t=e.asAbsolutePath(H));let i=w.workspace.getConfiguration().get("rustPanicHighlighter.icon.size")||64,r=w.workspace.getConfiguration().get("rustPanicHighlighter.icon.adjustTopPosition")||0;if(i!==void 0&&i<=0)throw new Error("icon.size must be a positive number.");let o=`${i}px`,s=`${i}px`,u=be(t,o,s),f=(0,Ye.default)(u),c=w.Uri.file(u),l=O(),a=f.height??64,v=a<=l?(a-l/4)/2:-((a-l/4)/2);v=v+r;let b={position:"absolute",top:`${v}px`,"z-index":1,"pointer-events":"none"},S=k(b);return w.window.createTextEditorDecorationType({after:{contentIconPath:c,textDecoration:`none; ${S}`,margin:"0 1rem"}})}function Ke(e,t){if(!(w.workspace.getConfiguration().get("rustPanicHighlighter.icon.enabled")??!0))return[];t==="default"&&(t=e.asAbsolutePath(H));let i=w.workspace.getConfiguration().get("rustPanicHighlighter.icon.size")||64,r=w.workspace.getConfiguration().get("rustPanicHighlighter.icon.adjustTopPosition")||0;if(i<=0)throw new Error("icon.size must be a positive number.");let o=`${i}px`,s=`${i}px`,u=ye.resolve(e.extensionPath,t),f=Wt.readdirSync(u),c=[];for(let l of f){let a;try{a=be(ye.join(u,l),o,s)}catch(Jt){console.error(`Error while creating decoration type for icon: ${l}, error : ${Jt}`);continue}if(!a)continue;let v=w.Uri.file(a),b=(0,Ye.default)(a),S=O(),I=b.height??64,C=I<=S?(I-S/4)/2:-((I-S/4)/2);C=C+r;let N={position:"absolute",top:`${C}px`,"z-index":1,"pointer-events":"none"},we=k(N),Yt=w.window.createTextEditorDecorationType({after:{contentIconPath:v,textDecoration:`none; ${we}`,margin:"0 1rem"}});c.push(Yt)}return c}var x=T(require("vscode"));var Xt=(a=>(a.unwrap="unwrap(",a.unwrap_unchecked="unwrap_unchecked(",a.unwrap_err="unwrap_err(",a.unwrap_err_unchecked="unwrap_err_unchecked(",a.expect='expect("',a.panic="panic!(",a.todo="todo!(",a.unimplemented="unimplemented!(",a.assert="assert!(",a.assert_eq="assert_eq!(",a.assert_ne="assert_ne!(",a))(Xt||{}),Mi={"unwrap(":"This line contains an 'unwrap()', which will panic if the result is None or Err.","unwrap_unchecked(":"This line contains an 'unwrap_unchecked()', which can cause undefined behavior if the result is None or Err.","unwrap_err(":"This line contains an 'unwrap_err()', which will panic if the result is Ok.","unwrap_err_unchecked(":"This line contains an 'unwrap_err_unchecked()', which can cause undefined behavior if the result is Ok.",'expect("':"This line contains an 'expect()', which will panic if the result is None or Err.","panic!(":"This line contains a 'panic!' which can cause a runtime panic.","todo!(":"This line contains a 'todo!' macro, which is a placeholder and will panic if executed.","unimplemented!(":"This line contains an 'unimplemented!' macro, which will panic if executed.","assert!(":"This line contains an 'assert!()', which will panic if the condition is false.","assert_eq!(":"This line contains an 'assert_eq!()', which will panic if the two values are not equal.","assert_ne!(":"This line contains an 'assert_ne!()', which will panic if the two values are equal."},Ni=O(),zi=Ni*.5,Ai=115*zi,Ri={position:"absolute","z-index":1,left:`${Ai}px`},Gi=k(Ri);function M(e,t,n,i,r,o,s){if(e.languageId!=="rust")return;let u=[],f=x.window.activeTextEditor,c=[],l=!1,a=0;for(let v=0;v<e.lineCount;v++){let b=e.lineAt(v);if(b.text.trimStart().startsWith("//"))continue;if(s){let I=Vi(b,l,a);if(l=I.inTestBlock,a=I.braceCount,I.shouldContinue)continue}let S=null;for(let[I,C]of Object.entries(Xt))if(!r.includes(I.toLowerCase())&&b.text.includes(C)){S=C;break}if(S){let I=Mi[S],C=b.text.indexOf(S),N=new x.Range(v,C,v,b.text.length);c.push(N);let we=new x.Diagnostic(N,I,i);u.push(we)}}$i(f,c,Gi,o,n,u,t,e)}function $i(e,t,n,i,r,o,s,u){if(e){r.forEach(c=>{e.setDecorations(c,[])});let f=r[Math.floor(Math.random()*r.length)];if(i){let c=t.map(l=>{let a=l.end.character>=105?"":n;return{range:l,renderOptions:{after:{textDecoration:a}}}});e.setDecorations(f,c)}else e.setDecorations(f,t);o.length===0?s.delete(u.uri):s.set(u.uri,o)}}function Vi(e,t,n){if(e.text.includes("#[test]"))return t=!0,n=0,{inTestBlock:t,braceCount:n,shouldContinue:!0};if(t)for(let i of e.text)i==="{"?n++:i==="}"&&(n--,n===0&&(t=!1));return{inTestBlock:t,braceCount:n,shouldContinue:t}}function Ze(){let e=x.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.severity"),t;switch(e){case"Error":t=x.DiagnosticSeverity.Error;break;case"Information":t=x.DiagnosticSeverity.Information;break;case"Hint":t=x.DiagnosticSeverity.Hint;break;case"Warning":default:t=x.DiagnosticSeverity.Warning;break}return t}function Wi(e){Se();let t=p.languages.createDiagnosticCollection("rust-panic-highlighter");e.subscriptions.push(t);let n=p.workspace.getConfiguration().get("rustPanicHighlighter.icon.path")||"default",i=Pe(e,n),r=[];Qe.default.lstatSync(i).isDirectory()?r=Ke(e,i):r=[Je(e,i)],r.forEach(c=>{e.subscriptions.push(c)});let o=Ze(),s=p.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoreInTestBlock",!0),u=p.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoredPanics",[]),f=p.workspace.getConfiguration().get("rustPanicHighlighter.icon.minXPositionEnabled",!0);p.workspace.textDocuments.forEach(c=>{c.languageId==="rust"&&M(c,t,r,o,u,f,s)}),p.workspace.onDidChangeTextDocument(c=>{c.document.languageId==="rust"&&M(c.document,t,r,o,u,f,s)}),p.workspace.onDidCloseTextDocument(c=>{c.languageId==="rust"&&t.delete(c.uri)}),p.window.onDidChangeActiveTextEditor(c=>{c&&c.document.languageId==="rust"&&M(c.document,t,r,o,u,f,s)}),p.workspace.onDidChangeConfiguration(c=>{c.affectsConfiguration("rustPanicHighlighter")&&(Se(),r.forEach(l=>{l.dispose()}),n=p.workspace.getConfiguration().get("rustPanicHighlighter.icon.path")||"default",i=Pe(e,n),Qe.default.lstatSync(i).isDirectory()?r=Ke(e,i):r=[Je(e,i)],r.forEach(l=>{e.subscriptions.push(l)}),o=Ze(),s=p.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoreInTestBlock",!0),u=p.workspace.getConfiguration().get("rustPanicHighlighter.diagnostic.ignoredPanics",[]),f=p.workspace.getConfiguration().get("rustPanicHighlighter.icon.minXPositionEnabled",!0),p.workspace.textDocuments.forEach(l=>{l.languageId==="rust"&&M(l,t,r,o,u,f,s)}))})}function Xi(){}0&&(module.exports={activate,deactivate});
